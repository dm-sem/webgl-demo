var dt=Object.defineProperty;var _t=(s,e,t)=>e in s?dt(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var b=(s,e,t)=>_t(s,typeof e!="symbol"?e+"":e,t);import{W as gt,V as mt,A as bt,E as vt,d as wt,e as Et,f as yt,g as St,h as Ge,G as Ct,T as Mt,a6 as et,m as kt,M as W,a7 as Pt,p as tt,a8 as de,a9 as Te,z as X,aa as st,o as F,y as xt,k as it,i as Tt,j as re,ab as At,_ as It,$ as nt,D as Ot,a2 as ke,a1 as Rt,a3 as jt,a4 as ee,a5 as z}from"./index-C1fAtsd0.js";import{A as xe,S as Nt,a as Dt,E as Lt,b as Ft,O as qt,D as zt}from"./Description-inFsM9GV.js";const Bt=[{name:"outlineAlpha",type:"texture",path:"/textures/outlineAlpha.jpg"},{name:"envMap3",type:"rgbe",path:"/textures/envMaps/4.hdr"},{name:"roundAlpha",type:"texture",path:"/textures/alpha.jpg"},{name:"particle",type:"texture",path:"/textures/particle.png"},{name:"woodenPlanks_Diffuse",type:"texture",path:"/textures/woodenPlanks/diff_1k.jpg"},{name:"woodenPlanks_ARM",type:"texture",path:"/textures/woodenPlanks/arm_1k.jpg"},{name:"woodenPlanks_Normal",type:"texture",path:"/textures/woodenPlanks/normal_1k.jpg"},{name:"stoneWall_Diffuse",type:"texture",path:"/textures/stoneWall/plastered_stone_wall_diff_1k.jpg"},{name:"stoneWall_ARM",type:"texture",path:"/textures/stoneWall/plastered_stone_wall_arm_1k.jpg"},{name:"stoneWall_Normal",type:"texture",path:"/textures/stoneWall/plastered_stone_wall_nor_gl_1k.jpg"},{name:"pavement_Diffuse",type:"texture",path:"/textures/pavement/pavement_02_diff_1k.jpg"},{name:"pavement_ARM",type:"texture",path:"/textures/pavement/pavement_02_arm_1k.jpg"},{name:"pavement_Normal",type:"texture",path:"/textures/pavement/pavement_02_nor_gl_1k.jpg"},{name:"testBoard",type:"gltf",path:"/models/chess/testBoard/chess_set_1k/chess_set_1k.gltf"},{name:"OBoard",type:"gltf",path:"/models/chess/OBoard2.glb"}];class Ut{constructor(e,t,i,r){b(this,"camera");b(this,"scene");b(this,"canvas");b(this,"size");b(this,"renderer");b(this,"effectComposer");b(this,"renderPass");b(this,"resize",()=>{this.renderer.setSize(this.size.width,this.size.height),this.renderer.setPixelRatio(this.size.pixelRatio)});b(this,"update",()=>{this.effectComposer.render()});this.canvas=e,this.scene=t,this.camera=i,this.size=r,this.renderer=new gt({canvas:this.canvas,antialias:!0}),this.resize(),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=mt,this.renderer.toneMapping=bt,this.renderer.toneMappingExposure=1,this.effectComposer=new vt(this.renderer),this.effectComposer.setPixelRatio(this.size.pixelRatio),this.effectComposer.setSize(this.size.width,this.size.height),this.renderPass=new wt(this.scene,this.camera),this.effectComposer.addPass(this.renderPass);const n=new Et;n.strength=.4,n.threshold=2.5,this.effectComposer.addPass(n);const o=new yt(5,this.scene,this.camera);o.normalEdgeStrength=0,o.enabled=!1,this.effectComposer.addPass(o);const a=new St(this.scene,this.camera);a.params.saoScale=4,a.params.saoIntensity=.08,a.params.saoKernelRadius=30,a.params.saoBlurRadius=3,this.effectComposer.addPass(a),a.enabled=!1;const l={uniforms:{tDiffuse:{type:"t",value:null},width:{type:"f",value:0},height:{type:"f",value:0},kernel:{type:"fv1",value:[-1,-1,-1,-1,9,-1,-1,-1,-1]}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float width;","uniform float height;","uniform float kernel[9];","void main(void)","{","float step_w = 1.0/width;","float step_h = 1.0/height;","vec2 offset[9];","offset[0] = vec2(-step_w, -step_h);","offset[1] = vec2(0.0, -step_h);","offset[2] = vec2(step_w, -step_h);","offset[3] = vec2(-step_w, 0.0);","offset[4] = vec2(0.0, 0.0);","offset[5] = vec2(step_w, 0.0);","offset[6] = vec2(-step_w, step_h);","offset[7] = vec2(0.0, step_h);","offset[8] = vec2(step_w, step_h);","vec3 sum = vec3(0.0);","for( int i=0; i<9; i++ )","sum += texture2D(tDiffuse, vUv + offset[i] * 0.095).rgb * kernel[i];","gl_FragColor = vec4(sum,1.0);","}"].join(`
`)},u=new Ge(l);u.uniforms.width.value=window.innerWidth,u.uniforms.height.value=window.innerHeight,u.enabled=!1,this.effectComposer.addPass(u);const _=new Ge(Ct);this.effectComposer.addPass(_),_.enabled=!1,this.effectComposer.renderTarget1.samples=4,this.effectComposer.renderTarget2.samples=4}dispose(){this.renderer.dispose()}}class Kt extends xe{constructor(){super();b(this,"pieces",[]);const t=this.assetsManager.assets.get("testBoard");this.add(t.scene),console.log(t.scene),t.scene.castShadow=!0,t.scene.receiveShadow=!0;for(let p=0;p<t.scene.children.length;p++){const c=t.scene.children[p];c.castShadow=!0,c.receiveShadow=!0,c.name.includes("piece")&&(c.type==="Group"&&(t.scene.children[p]=c.children[0],t.scene.children[p].name=c.name,t.scene.children[p].position.add(c.position),t.scene.children[p].matrix=c.matrix,t.scene.children[p].parent=c.parent,t.scene.children[p].updateMatrixWorld(!0),t.scene.children[p].castShadow=!0,t.scene.children[p].receiveShadow=!0),this.pieces.push(t.scene.children[p]))}const i=this.pieces.find(({name:p})=>p==="piece_king_white"),r=this.pieces.find(({name:p})=>p==="piece_queen_white"),n=i.position.clone(),o=r.position.clone();i.position.set(o.x,o.y,o.z),r.position.set(n.x,n.y,n.z);const a=this.pieces.find(({name:p})=>p==="piece_king_black"),l=this.pieces.find(({name:p})=>p==="piece_queen_black"),u=a.position.clone(),_=l.position.clone();a.position.set(_.x,_.y,_.z),l.position.set(u.x,u.y,u.z),t.scene.scale.setScalar(20)}}class Wt extends xe{constructor(){super();const e=new Mt(.5,.005,64),t=new et({color:3407701,side:kt,emissive:3407701,emissiveIntensity:5}),i=new W(e,t);i.rotation.x=Math.PI/2,this.visible=!1,this.add(i)}}const le=new st,Q=new X,rt=new F,Ae=new X,Ce=new X,Pe=new F,Ne=new F,ot=new xt,at=new F,lt=new F;let j=null,B=null;const H=[],Z={NONE:-1,PAN:0,ROTATE:1};class $e extends Pt{constructor(e,t,i=null){super(t,i),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new tt,this.mouseButtons={LEFT:de.PAN,MIDDLE:de.PAN,RIGHT:de.ROTATE},this.touches={ONE:Te.PAN},this._onPointerMove=Qt.bind(this),this._onPointerDown=Ht.bind(this),this._onPointerCancel=Gt.bind(this),this._onContextMenu=$t.bind(this),i!==null&&this.connect()}connect(){this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const t=this.domElement.getBoundingClientRect();Q.x=(e.clientX-t.left)/t.width*2-1,Q.y=-(e.clientY-t.top)/t.height*2+1}_updateState(e){let t;if(e.pointerType==="touch")t=this.touches.ONE;else switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=null}switch(t){case de.PAN:case Te.PAN:this.state=Z.PAN;break;case de.ROTATE:case Te.ROTATE:this.state=Z.ROTATE;break;default:this.state=Z.NONE}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(e){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=e}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(e){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function Qt(s){const e=this.object,t=this.domElement,i=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(s),i.setFromCamera(Q,e),j)this.state===Z.PAN?i.ray.intersectPlane(le,Pe)&&j.position.copy(Pe.sub(rt).applyMatrix4(ot)):this.state===Z.ROTATE&&(Ae.subVectors(Q,Ce).multiplyScalar(this.rotateSpeed),j.rotateOnWorldAxis(at,Ae.x),j.rotateOnWorldAxis(lt.normalize(),-Ae.y)),this.dispatchEvent({type:"drag",object:j}),Ce.copy(Q);else if(s.pointerType==="mouse"||s.pointerType==="pen")if(H.length=0,i.setFromCamera(Q,e),i.intersectObjects(this.objects,this.recursive,H),H.length>0){const r=H[0].object;le.setFromNormalAndCoplanarPoint(e.getWorldDirection(le.normal),Ne.setFromMatrixPosition(r.matrixWorld)),B!==r&&B!==null&&(this.dispatchEvent({type:"hoveroff",object:B}),t.style.cursor="auto",B=null),B!==r&&(this.dispatchEvent({type:"hoveron",object:r}),t.style.cursor="pointer",B=r)}else B!==null&&(this.dispatchEvent({type:"hoveroff",object:B}),t.style.cursor="auto",B=null);Ce.copy(Q)}}function Ht(s){const e=this.object,t=this.domElement,i=this.raycaster;this.enabled!==!1&&(this._updatePointer(s),this._updateState(s),H.length=0,i.setFromCamera(Q,e),i.intersectObjects(this.objects,this.recursive,H),H.length>0&&(this.transformGroup===!0?j=ht(H[0].object):j=H[0].object,le.setFromNormalAndCoplanarPoint(e.getWorldDirection(le.normal),Ne.setFromMatrixPosition(j.matrixWorld)),i.ray.intersectPlane(le,Pe)&&(this.state===Z.PAN?(ot.copy(j.parent.matrixWorld).invert(),rt.copy(Pe).sub(Ne.setFromMatrixPosition(j.matrixWorld))):this.state===Z.ROTATE&&(at.set(0,1,0).applyQuaternion(e.quaternion).normalize(),lt.set(1,0,0).applyQuaternion(e.quaternion).normalize())),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:j})),Ce.copy(Q))}function Gt(){this.enabled!==!1&&(j&&(this.dispatchEvent({type:"dragend",object:j}),j=null),this.domElement.style.cursor=B?"pointer":"auto",this.state=Z.NONE)}function $t(s){this.enabled!==!1&&s.preventDefault()}function ht(s,e=null){return s.isGroup&&(e=s),s.parent===null?e:ht(s.parent,e)}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const I="w",L="b",T="p",De="n",Me="b",ge="r",Y="q",x="k",Ie="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class Ee{constructor(e,t){b(this,"color");b(this,"from");b(this,"to");b(this,"piece");b(this,"captured");b(this,"promotion");b(this,"flags");b(this,"san");b(this,"lan");b(this,"before");b(this,"after");const{color:i,piece:r,from:n,to:o,flags:a,captured:l,promotion:u}=t,_=O(n),p=O(o);this.color=i,this.piece=r,this.from=_,this.to=p,this.san=e._moveToSan(t,e._moves({legal:!0})),this.lan=_+p,this.before=e.fen(),e._makeMove(t),this.after=e.fen(),e._undoMove(),this.flags="";for(const c in S)S[c]&a&&(this.flags+=te[c]);l&&(this.captured=l),u&&(this.promotion=u,this.lan+=u)}isCapture(){return this.flags.indexOf(te.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(te.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(te.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(te.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(te.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(te.BIG_PAWN)>-1}}const R=-1,te={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},S={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},y={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Oe={b:[16,32,17,15],w:[-16,-32,-17,-15]},Ye={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Yt=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Xt=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Zt={p:1,n:2,b:4,r:8,q:16,k:32},Jt="pnbrqkPNBRQK",Xe=[De,Me,ge,Y],Vt=7,es=6,ts=1,ss=0,ye={[x]:S.KSIDE_CASTLE,[Y]:S.QSIDE_CASTLE},G={w:[{square:y.a1,flag:S.QSIDE_CASTLE},{square:y.h1,flag:S.KSIDE_CASTLE}],b:[{square:y.a8,flag:S.QSIDE_CASTLE},{square:y.h8,flag:S.KSIDE_CASTLE}]},is={b:ts,w:es},ns=["1-0","0-1","1/2-1/2","*"];function se(s){return s>>4}function ve(s){return s&15}function ct(s){return"0123456789".indexOf(s)!==-1}function O(s){const e=ve(s),t=se(s);return"abcdefgh".substring(e,e+1)+"87654321".substring(t,t+1)}function _e(s){return s===I?L:I}function rs(s){const e=s.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const t=parseInt(e[5],10);if(isNaN(t)||t<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const i=parseInt(e[4],10);if(isNaN(i)||i<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const r=e[0].split("/");if(r.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let o=0;o<r.length;o++){let a=0,l=!1;for(let u=0;u<r[o].length;u++)if(ct(r[o][u])){if(l)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};a+=parseInt(r[o][u],10),l=!0}else{if(!/^[prnbqkPRNBQK]$/.test(r[o][u]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};a+=1,l=!1}if(a!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const n=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:o,regex:a}of n){if(!a.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${o} king`};if((e[0].match(a)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${o} kings`}}return Array.from(r[0]+r[7]).some(o=>o.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function os(s,e){const t=s.from,i=s.to,r=s.piece;let n=0,o=0,a=0;for(let l=0,u=e.length;l<u;l++){const _=e[l].from,p=e[l].to,c=e[l].piece;r===c&&t!==_&&i===p&&(n++,se(t)===se(_)&&o++,ve(t)===ve(_)&&a++)}return n>0?o>0&&a>0?O(t):a>0?O(t).charAt(1):O(t).charAt(0):""}function $(s,e,t,i,r,n=void 0,o=S.NORMAL){const a=se(i);if(r===T&&(a===Vt||a===ss))for(let l=0;l<Xe.length;l++){const u=Xe[l];s.push({color:e,from:t,to:i,piece:r,captured:n,promotion:u,flags:o|S.PROMOTION})}else s.push({color:e,from:t,to:i,piece:r,captured:n,flags:o})}function Ze(s){let e=s.charAt(0);return e>="a"&&e<="h"?s.match(/[a-h]\d.*[a-h]\d/)?void 0:T:(e=e.toLowerCase(),e==="o"?x:e)}function Re(s){return s.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function je(s){return s.split(" ").slice(0,4).join(" ")}class as{constructor(e=Ie,{skipValidation:t=!1}={}){b(this,"_board",new Array(128));b(this,"_turn",I);b(this,"_header",{});b(this,"_kings",{w:R,b:R});b(this,"_epSquare",-1);b(this,"_halfMoves",0);b(this,"_moveNumber",0);b(this,"_history",[]);b(this,"_comments",{});b(this,"_castling",{w:0,b:0});b(this,"_positionCount",{});this.load(e,{skipValidation:t})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:R,b:R},this._turn=I,this._castling={w:0,b:0},this._epSquare=R,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{},this._positionCount={},delete this._header.SetUp,delete this._header.FEN}load(e,{skipValidation:t=!1,preserveHeaders:i=!1}={}){let r=e.split(/\s+/);if(r.length>=2&&r.length<6){const a=["-","-","0","1"];e=r.concat(a.slice(-(6-r.length))).join(" ")}if(r=e.split(/\s+/),!t){const{ok:a,error:l}=rs(e);if(!a)throw new Error(l)}const n=r[0];let o=0;this.clear({preserveHeaders:i});for(let a=0;a<n.length;a++){const l=n.charAt(a);if(l==="/")o+=8;else if(ct(l))o+=parseInt(l,10);else{const u=l<"a"?I:L;this._put({type:l.toLowerCase(),color:u},O(o)),o++}}this._turn=r[1],r[2].indexOf("K")>-1&&(this._castling.w|=S.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(this._castling.w|=S.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(this._castling.b|=S.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(this._castling.b|=S.QSIDE_CASTLE),this._epSquare=r[3]==="-"?R:y[r[3]],this._halfMoves=parseInt(r[4],10),this._moveNumber=parseInt(r[5],10),this._updateSetup(e),this._incPositionCount(e)}fen(){var n,o;let e=0,t="";for(let a=y.a8;a<=y.h1;a++){if(this._board[a]){e>0&&(t+=e,e=0);const{color:l,type:u}=this._board[a];t+=l===I?u.toUpperCase():u.toLowerCase()}else e++;a+1&136&&(e>0&&(t+=e),a!==y.h1&&(t+="/"),e=0,a+=8)}let i="";this._castling[I]&S.KSIDE_CASTLE&&(i+="K"),this._castling[I]&S.QSIDE_CASTLE&&(i+="Q"),this._castling[L]&S.KSIDE_CASTLE&&(i+="k"),this._castling[L]&S.QSIDE_CASTLE&&(i+="q"),i=i||"-";let r="-";if(this._epSquare!==R){const a=this._epSquare+(this._turn===I?16:-16),l=[a+1,a-1];for(const u of l){if(u&136)continue;const _=this._turn;if(((n=this._board[u])==null?void 0:n.color)===_&&((o=this._board[u])==null?void 0:o.type)===T){this._makeMove({color:_,from:u,to:this._epSquare,piece:T,captured:T,flags:S.EP_CAPTURE});const p=!this._isKingAttacked(_);if(this._undoMove(),p){r=O(this._epSquare);break}}}}return[t,this._turn,i,r,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==Ie?(this._header.SetUp="1",this._header.FEN=e):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(Ie)}get(e){return this._board[y[e]]}put({type:e,color:t},i){return this._put({type:e,color:t},i)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_put({type:e,color:t},i){if(Jt.indexOf(e.toLowerCase())===-1||!(i in y))return!1;const r=y[i];if(e==x&&!(this._kings[t]==R||this._kings[t]==r))return!1;const n=this._board[r];return n&&n.type===x&&(this._kings[n.color]=R),this._board[r]={type:e,color:t},e===x&&(this._kings[t]=r),!0}remove(e){const t=this.get(e);return delete this._board[y[e]],t&&t.type===x&&(this._kings[t.color]=R),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){var i,r,n,o,a,l,u,_,p,c,w,f;const e=((i=this._board[y.e1])==null?void 0:i.type)===x&&((r=this._board[y.e1])==null?void 0:r.color)===I,t=((n=this._board[y.e8])==null?void 0:n.type)===x&&((o=this._board[y.e8])==null?void 0:o.color)===L;(!e||((a=this._board[y.a1])==null?void 0:a.type)!==ge||((l=this._board[y.a1])==null?void 0:l.color)!==I)&&(this._castling.w&=-65),(!e||((u=this._board[y.h1])==null?void 0:u.type)!==ge||((_=this._board[y.h1])==null?void 0:_.color)!==I)&&(this._castling.w&=-33),(!t||((p=this._board[y.a8])==null?void 0:p.type)!==ge||((c=this._board[y.a8])==null?void 0:c.color)!==L)&&(this._castling.b&=-65),(!t||((w=this._board[y.h8])==null?void 0:w.type)!==ge||((f=this._board[y.h8])==null?void 0:f.color)!==L)&&(this._castling.b&=-33)}_updateEnPassantSquare(){var n,o;if(this._epSquare===R)return;const e=this._epSquare+(this._turn===I?-16:16),t=this._epSquare+(this._turn===I?16:-16),i=[t+1,t-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((n=this._board[t])==null?void 0:n.color)!==_e(this._turn)||((o=this._board[t])==null?void 0:o.type)!==T){this._epSquare=R;return}const r=a=>{var l,u;return!(a&136)&&((l=this._board[a])==null?void 0:l.color)===this._turn&&((u=this._board[a])==null?void 0:u.type)===T};i.some(r)||(this._epSquare=R)}_attacked(e,t,i){const r=[];for(let n=y.a8;n<=y.h1;n++){if(n&136){n+=7;continue}if(this._board[n]===void 0||this._board[n].color!==e)continue;const o=this._board[n],a=n-t;if(a===0)continue;const l=a+119;if(Yt[l]&Zt[o.type]){if(o.type===T){if(a>0&&o.color===I||a<=0&&o.color===L)if(i)r.push(O(n));else return!0;continue}if(o.type==="n"||o.type==="k")if(i){r.push(O(n));continue}else return!0;const u=Xt[l];let _=n+u,p=!1;for(;_!==t;){if(this._board[_]!=null){p=!0;break}_+=u}if(!p)if(i){r.push(O(n));continue}else return!0}}return i?r:!1}attackers(e,t){return t?this._attacked(t,y[e],!0):this._attacked(this._turn,y[e],!0)}_isKingAttacked(e){const t=this._kings[e];return t===-1?!1:this._attacked(_e(e),t)}isAttacked(e,t){return this._attacked(t,y[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},t=[];let i=0,r=0;for(let n=y.a8;n<=y.h1;n++){if(r=(r+1)%2,n&136){n+=7;continue}const o=this._board[n];o&&(e[o.type]=o.type in e?e[o.type]+1:1,o.type===Me&&t.push(r),i++)}if(i===2)return!0;if(i===3&&(e[Me]===1||e[De]===1))return!0;if(i===e[Me]+2){let n=0;const o=t.length;for(let a=0;a<o;a++)n+=t[a];if(n===0||n===o)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this.fen())>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:t=void 0,piece:i=void 0}={}){const r=this._moves({square:t,piece:i});return e?r.map(n=>new Ee(this,n)):r.map(n=>this._moveToSan(n,r))}_moves({legal:e=!0,piece:t=void 0,square:i=void 0}={}){var w;const r=i?i.toLowerCase():void 0,n=t==null?void 0:t.toLowerCase(),o=[],a=this._turn,l=_e(a);let u=y.a8,_=y.h1,p=!1;if(r)if(r in y)u=_=y[r],p=!0;else return[];for(let f=u;f<=_;f++){if(f&136){f+=7;continue}if(!this._board[f]||this._board[f].color===l)continue;const{type:E}=this._board[f];let m;if(E===T){if(n&&n!==E)continue;m=f+Oe[a][0],this._board[m]||($(o,a,f,m,T),m=f+Oe[a][1],is[a]===se(f)&&!this._board[m]&&$(o,a,f,m,T,void 0,S.BIG_PAWN));for(let d=2;d<4;d++)m=f+Oe[a][d],!(m&136)&&(((w=this._board[m])==null?void 0:w.color)===l?$(o,a,f,m,T,this._board[m].type,S.CAPTURE):m===this._epSquare&&$(o,a,f,m,T,T,S.EP_CAPTURE))}else{if(n&&n!==E)continue;for(let d=0,k=Ye[E].length;d<k;d++){const v=Ye[E][d];for(m=f;m+=v,!(m&136);){if(!this._board[m])$(o,a,f,m,E);else{if(this._board[m].color===a)break;$(o,a,f,m,E,this._board[m].type,S.CAPTURE);break}if(E===De||E===x)break}}}}if((n===void 0||n===x)&&(!p||_===this._kings[a])){if(this._castling[a]&S.KSIDE_CASTLE){const f=this._kings[a],E=f+2;!this._board[f+1]&&!this._board[E]&&!this._attacked(l,this._kings[a])&&!this._attacked(l,f+1)&&!this._attacked(l,E)&&$(o,a,this._kings[a],E,x,void 0,S.KSIDE_CASTLE)}if(this._castling[a]&S.QSIDE_CASTLE){const f=this._kings[a],E=f-2;!this._board[f-1]&&!this._board[f-2]&&!this._board[f-3]&&!this._attacked(l,this._kings[a])&&!this._attacked(l,f-1)&&!this._attacked(l,E)&&$(o,a,this._kings[a],E,x,void 0,S.QSIDE_CASTLE)}}if(!e||this._kings[a]===-1)return o;const c=[];for(let f=0,E=o.length;f<E;f++)this._makeMove(o[f]),this._isKingAttacked(a)||c.push(o[f]),this._undoMove();return c}move(e,{strict:t=!1}={}){let i=null;if(typeof e=="string")i=this._moveFromSan(e,t);else if(typeof e=="object"){const n=this._moves();for(let o=0,a=n.length;o<a;o++)if(e.from===O(n[o].from)&&e.to===O(n[o].to)&&(!("promotion"in n[o])||e.promotion===n[o].promotion)){i=n[o];break}}if(!i)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);const r=new Ee(this,i);return this._makeMove(i),this._incPositionCount(r.after),r}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){const t=this._turn,i=_e(t);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&S.EP_CAPTURE&&(this._turn===L?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:t}),this._board[e.to].type===x){if(this._kings[t]=e.to,e.flags&S.KSIDE_CASTLE){const r=e.to-1,n=e.to+1;this._board[r]=this._board[n],delete this._board[n]}else if(e.flags&S.QSIDE_CASTLE){const r=e.to+1,n=e.to-2;this._board[r]=this._board[n],delete this._board[n]}this._castling[t]=0}if(this._castling[t]){for(let r=0,n=G[t].length;r<n;r++)if(e.from===G[t][r].square&&this._castling[t]&G[t][r].flag){this._castling[t]^=G[t][r].flag;break}}if(this._castling[i]){for(let r=0,n=G[i].length;r<n;r++)if(e.to===G[i][r].square&&this._castling[i]&G[i][r].flag){this._castling[i]^=G[i][r].flag;break}}e.flags&S.BIG_PAWN?t===L?this._epSquare=e.to-16:this._epSquare=e.to+16:this._epSquare=R,e.piece===T?this._halfMoves=0:e.flags&(S.CAPTURE|S.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===L&&this._moveNumber++,this._turn=i}undo(){const e=this._undoMove();if(e){const t=new Ee(this,e);return this._decPositionCount(t.after),t}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;const t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;const i=this._turn,r=_e(i);if(this._board[t.from]=this._board[t.to],this._board[t.from].type=t.piece,delete this._board[t.to],t.captured)if(t.flags&S.EP_CAPTURE){let n;i===L?n=t.to-16:n=t.to+16,this._board[n]={type:T,color:r}}else this._board[t.to]={type:t.captured,color:r};if(t.flags&(S.KSIDE_CASTLE|S.QSIDE_CASTLE)){let n,o;t.flags&S.KSIDE_CASTLE?(n=t.to+1,o=t.to-1):(n=t.to-2,o=t.to+1),this._board[n]=this._board[o],delete this._board[o]}return t}pgn({newline:e=`
`,maxWidth:t=0}={}){const i=[];let r=!1;for(const c in this._header)i.push("["+c+' "'+this._header[c]+'"]'+e),r=!0;r&&this._history.length&&i.push(e);const n=c=>{const w=this._comments[this.fen()];if(typeof w<"u"){const f=c.length>0?" ":"";c=`${c}${f}{${w}}`}return c},o=[];for(;this._history.length>0;)o.push(this._undoMove());const a=[];let l="";for(o.length===0&&a.push(n(""));o.length>0;){l=n(l);const c=o.pop();if(!c)break;if(!this._history.length&&c.color==="b"){const w=`${this._moveNumber}. ...`;l=l?`${l} ${w}`:w}else c.color==="w"&&(l.length&&a.push(l),l=this._moveNumber+".");l=l+" "+this._moveToSan(c,this._moves({legal:!0})),this._makeMove(c)}if(l.length&&a.push(n(l)),typeof this._header.Result<"u"&&a.push(this._header.Result),t===0)return i.join("")+a.join(" ");const u=function(){return i.length>0&&i[i.length-1]===" "?(i.pop(),!0):!1},_=function(c,w){for(const f of w.split(" "))if(f){if(c+f.length>t){for(;u();)c--;i.push(e),c=0}i.push(f),c+=f.length,i.push(" "),c++}return u()&&c--,c};let p=0;for(let c=0;c<a.length;c++){if(p+a[c].length>t&&a[c].includes("{")){p=_(p,a[c]);continue}p+a[c].length>t&&c!==0?(i[i.length-1]===" "&&i.pop(),i.push(e),p=0):c!==0&&(i.push(" "),p++),i.push(a[c]),p+=a[c].length}return i.join("")}header(...e){for(let t=0;t<e.length;t+=2)typeof e[t]=="string"&&typeof e[t+1]=="string"&&(this._header[e[t]]=e[t+1]);return this._header}setHeader(e,t){return this._header[e]=t,this._header}removeHeader(e){return e in this._header?(delete this._header[e],!0):!1}getHeaders(){return this._header}loadPgn(e,{strict:t=!1,newlineChar:i=`\r?
`}={}){function r(v){return v.replace(/\\/g,"\\")}function n(v){const A={},N=v.split(new RegExp(r(i)));let ie="",he="";for(let J=0;J<N.length;J++){const K=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;ie=N[J].replace(K,"$1"),he=N[J].replace(K,"$2"),ie.trim().length>0&&(A[ie]=he)}return A}e=e.trim();const a=new RegExp("^(\\[((?:"+r(i)+")|.)*\\])((?:\\s*"+r(i)+"){2}|(?:\\s*"+r(i)+")*$)").exec(e),l=a&&a.length>=2?a[1]:"";this.reset();const u=n(l);let _="";for(const v in u)v.toLowerCase()==="fen"&&(_=u[v]),this.header(v,u[v]);if(!t)_&&this.load(_,{preserveHeaders:!0});else if(u.SetUp==="1"){if(!("FEN"in u))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(u.FEN,{preserveHeaders:!0})}function p(v){return Array.from(v).map(function(A){return A.charCodeAt(0)<128?A.charCodeAt(0).toString(16):encodeURIComponent(A).replace(/%/g,"").toLowerCase()}).join("")}function c(v){return v.length==0?"":decodeURIComponent("%"+(v.match(/.{1,2}/g)||[]).join("%"))}const w=function(v){return v=v.replace(new RegExp(r(i),"g")," "),`{${p(v.slice(1,v.length-1))}}`},f=function(v){if(v.startsWith("{")&&v.endsWith("}"))return c(v.slice(1,v.length-1))};let E=e.replace(l,"").replace(new RegExp(`({[^}]*})+?|;([^${r(i)}]*)`,"g"),function(v,A,N){return A!==void 0?w(A):" "+w(`{${N.slice(1)}}`)}).replace(new RegExp(r(i),"g")," ");const m=/(\([^()]+\))+?/g;for(;m.test(E);)E=E.replace(m,"");E=E.replace(/\d+\.(\.\.)?/g,""),E=E.replace(/\.\.\./g,""),E=E.replace(/\$\d+/g,"");let d=E.trim().split(new RegExp(/\s+/));d=d.filter(v=>v!=="");let k="";for(let v=0;v<d.length;v++){const A=f(d[v]);if(A!==void 0){this._comments[this.fen()]=A;continue}const N=this._moveFromSan(d[v],t);if(N==null)if(ns.indexOf(d[v])>-1)k=d[v];else throw new Error(`Invalid move in PGN: ${d[v]}`);else k="",this._makeMove(N),this._incPositionCount(this.fen())}k&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",k)}_moveToSan(e,t){let i="";if(e.flags&S.KSIDE_CASTLE)i="O-O";else if(e.flags&S.QSIDE_CASTLE)i="O-O-O";else{if(e.piece!==T){const r=os(e,t);i+=e.piece.toUpperCase()+r}e.flags&(S.CAPTURE|S.EP_CAPTURE)&&(e.piece===T&&(i+=O(e.from)[0]),i+="x"),i+=O(e.to),e.promotion&&(i+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?i+="#":i+="+"),this._undoMove(),i}_moveFromSan(e,t=!1){const i=Re(e);let r=Ze(i),n=this._moves({legal:!0,piece:r});for(let c=0,w=n.length;c<w;c++)if(i===Re(this._moveToSan(n[c],n)))return n[c];if(t)return null;let o,a,l,u,_,p=!1;if(a=i.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),a?(o=a[1],l=a[2],u=a[3],_=a[4],l.length==1&&(p=!0)):(a=i.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),a&&(o=a[1],l=a[2],u=a[3],_=a[4],l.length==1&&(p=!0))),r=Ze(i),n=this._moves({legal:!0,piece:o||r}),!u)return null;for(let c=0,w=n.length;c<w;c++)if(l){if((!o||o.toLowerCase()==n[c].piece)&&y[l]==n[c].from&&y[u]==n[c].to&&(!_||_.toLowerCase()==n[c].promotion))return n[c];if(p){const f=O(n[c].from);if((!o||o.toLowerCase()==n[c].piece)&&y[u]==n[c].to&&(l==f[0]||l==f[1])&&(!_||_.toLowerCase()==n[c].promotion))return n[c]}}else if(i===Re(this._moveToSan(n[c],n)).replace("x",""))return n[c];return null}ascii(){let e=`   +------------------------+
`;for(let t=y.a8;t<=y.h1;t++){if(ve(t)===0&&(e+=" "+"87654321"[se(t)]+" |"),this._board[t]){const i=this._board[t].type,n=this._board[t].color===I?i.toUpperCase():i.toLowerCase();e+=" "+n+" "}else e+=" . ";t+1&136&&(e+=`|
`,t+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let i=0;const r=this._turn;for(let n=0,o=t.length;n<o;n++)this._makeMove(t[n]),this._isKingAttacked(r)||(e-1>0?i+=this.perft(e-1):i++),this._undoMove();return i}turn(){return this._turn}board(){const e=[];let t=[];for(let i=y.a8;i<=y.h1;i++)this._board[i]==null?t.push(null):t.push({square:O(i),type:this._board[i].type,color:this._board[i].color}),i+1&136&&(e.push(t),t=[],i+=8);return e}squareColor(e){if(e in y){const t=y[e];return(se(t)+ve(t))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],i=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const r=t.pop();if(!r)break;e?i.push(new Ee(this,r)):i.push(this._moveToSan(r,this._moves())),this._makeMove(r)}return i}_getPositionCount(e){const t=je(e);return this._positionCount[t]||0}_incPositionCount(e){const t=je(e);this._positionCount[t]===void 0&&(this._positionCount[t]=0),this._positionCount[t]+=1}_decPositionCount(e){const t=je(e);this._positionCount[t]===1?delete this._positionCount[t]:this._positionCount[t]-=1}_pruneComments(){const e=[],t={},i=r=>{r in this._comments&&(t[r]=this._comments[r])};for(;this._history.length>0;)e.push(this._undoMove());for(i(this.fen());;){const r=e.pop();if(!r)break;this._makeMove(r),i(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(const r of[x,Y])t[r]!==void 0&&(t[r]?this._castling[e]|=ye[r]:this._castling[e]&=~ye[r]);this._updateCastlingRights();const i=this.getCastlingRights(e);return(t[x]===void 0||t[x]===i[x])&&(t[Y]===void 0||t[Y]===i[Y])}getCastlingRights(e){return{[x]:(this._castling[e]&ye[x])!==0,[Y]:(this._castling[e]&ye[Y])!==0}}moveNumber(){return this._moveNumber}}class ls extends xe{constructor(){super();b(this,"material");const t=this.assetsManager.assets.get("outlineAlpha"),i=new it(1,1,2,2);this.material=new et({color:3407701,emissive:3407701,emissiveIntensity:10,opacity:1,transparent:!0}),this.material.alphaMap=t;const r=new W(i,this.material);r.rotation.x=-Math.PI/2,this.visible=!1,this.add(r)}markError(){this.material.color.set(16750865),this.material.emissive.set(16750865),this.material.emissiveIntensity=20}markSuccess(){this.material.color.set(5635840),this.material.emissive.set(5635840),this.material.emissiveIntensity=10}}var be=Object.freeze({Linear:Object.freeze({None:function(s){return s},In:function(s){return s},Out:function(s){return s},InOut:function(s){return s}}),Quadratic:Object.freeze({In:function(s){return s*s},Out:function(s){return s*(2-s)},InOut:function(s){return(s*=2)<1?.5*s*s:-.5*(--s*(s-2)-1)}}),Cubic:Object.freeze({In:function(s){return s*s*s},Out:function(s){return--s*s*s+1},InOut:function(s){return(s*=2)<1?.5*s*s*s:.5*((s-=2)*s*s+2)}}),Quartic:Object.freeze({In:function(s){return s*s*s*s},Out:function(s){return 1- --s*s*s*s},InOut:function(s){return(s*=2)<1?.5*s*s*s*s:-.5*((s-=2)*s*s*s-2)}}),Quintic:Object.freeze({In:function(s){return s*s*s*s*s},Out:function(s){return--s*s*s*s*s+1},InOut:function(s){return(s*=2)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2)}}),Sinusoidal:Object.freeze({In:function(s){return 1-Math.sin((1-s)*Math.PI/2)},Out:function(s){return Math.sin(s*Math.PI/2)},InOut:function(s){return .5*(1-Math.sin(Math.PI*(.5-s)))}}),Exponential:Object.freeze({In:function(s){return s===0?0:Math.pow(1024,s-1)},Out:function(s){return s===1?1:1-Math.pow(2,-10*s)},InOut:function(s){return s===0?0:s===1?1:(s*=2)<1?.5*Math.pow(1024,s-1):.5*(-Math.pow(2,-10*(s-1))+2)}}),Circular:Object.freeze({In:function(s){return 1-Math.sqrt(1-s*s)},Out:function(s){return Math.sqrt(1- --s*s)},InOut:function(s){return(s*=2)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1)}}),Elastic:Object.freeze({In:function(s){return s===0?0:s===1?1:-Math.pow(2,10*(s-1))*Math.sin((s-1.1)*5*Math.PI)},Out:function(s){return s===0?0:s===1?1:Math.pow(2,-10*s)*Math.sin((s-.1)*5*Math.PI)+1},InOut:function(s){return s===0?0:s===1?1:(s*=2,s<1?-.5*Math.pow(2,10*(s-1))*Math.sin((s-1.1)*5*Math.PI):.5*Math.pow(2,-10*(s-1))*Math.sin((s-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(s){var e=1.70158;return s===1?1:s*s*((e+1)*s-e)},Out:function(s){var e=1.70158;return s===0?0:--s*s*((e+1)*s+e)+1},InOut:function(s){var e=2.5949095;return(s*=2)<1?.5*(s*s*((e+1)*s-e)):.5*((s-=2)*s*((e+1)*s+e)+2)}}),Bounce:Object.freeze({In:function(s){return 1-be.Bounce.Out(1-s)},Out:function(s){return s<1/2.75?7.5625*s*s:s<2/2.75?7.5625*(s-=1.5/2.75)*s+.75:s<2.5/2.75?7.5625*(s-=2.25/2.75)*s+.9375:7.5625*(s-=2.625/2.75)*s+.984375},InOut:function(s){return s<.5?be.Bounce.In(s*2)*.5:be.Bounce.Out(s*2-1)*.5+.5}}),generatePow:function(s){return s===void 0&&(s=4),s=s<Number.EPSILON?Number.EPSILON:s,s=s>1e4?1e4:s,{In:function(e){return Math.pow(e,s)},Out:function(e){return 1-Math.pow(1-e,s)},InOut:function(e){return e<.5?Math.pow(e*2,s)/2:(1-Math.pow(2-e*2,s))/2+.5}}}}),me=function(){return performance.now()},hs=function(){function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return s.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},s.prototype.removeAll=function(){this._tweens={}},s.prototype.add=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];for(var r=0,n=t;r<n.length;r++){var o=n[r];(e=o._group)===null||e===void 0||e.remove(o),o._group=this,this._tweens[o.getId()]=o,this._tweensAddedDuringUpdate[o.getId()]=o}},s.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=0,r=e;i<r.length;i++){var n=r[i];n._group=void 0,delete this._tweens[n.getId()],delete this._tweensAddedDuringUpdate[n.getId()]}},s.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},s.prototype.update=function(e,t){e===void 0&&(e=me()),t===void 0&&(t=!0);var i=Object.keys(this._tweens);if(i.length!==0)for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var n=this._tweens[i[r]],o=!t;n&&n.update(e,o)===!1&&!t&&this.remove(n)}i=Object.keys(this._tweensAddedDuringUpdate)}},s}(),Le={Linear:function(s,e){var t=s.length-1,i=t*e,r=Math.floor(i),n=Le.Utils.Linear;return e<0?n(s[0],s[1],i):e>1?n(s[t],s[t-1],t-i):n(s[r],s[r+1>t?t:r+1],i-r)},Utils:{Linear:function(s,e,t){return(e-s)*t+s}}},ut=function(){function s(){}return s.nextId=function(){return s._nextId++},s._nextId=0,s}(),Fe=new hs,Je=function(){function s(e,t){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=be.Linear.None,this._interpolationFunction=Le.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=ut.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,typeof t=="object"?(this._group=t,t.add(this)):t===!0&&(this._group=Fe,Fe.add(this))}return s.prototype.getId=function(){return this._id},s.prototype.isPlaying=function(){return this._isPlaying},s.prototype.isPaused=function(){return this._isPaused},s.prototype.getDuration=function(){return this._duration},s.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},s.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},s.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},s.prototype.start=function(e,t){if(e===void 0&&(e=me()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var i in this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var n in this._valuesEnd)r[n]=this._valuesEnd[n];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},s.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},s.prototype._setupProperties=function(e,t,i,r,n){for(var o in i){var a=e[o],l=Array.isArray(a),u=l?"array":typeof a,_=!l&&Array.isArray(i[o]);if(!(u==="undefined"||u==="function")){if(_){var p=i[o];if(p.length===0)continue;for(var c=[a],w=0,f=p.length;w<f;w+=1){var E=this._handleRelativeValue(a,p[w]);if(isNaN(E)){_=!1,console.warn("Found invalid interpolation list. Skipping.");break}c.push(E)}_&&(i[o]=c)}if((u==="object"||l)&&a&&!_){t[o]=l?[]:{};var m=a;for(var d in m)t[o][d]=m[d];r[o]=l?[]:{};var p=i[o];if(!this._isDynamic){var k={};for(var d in p)k[d]=p[d];i[o]=p=k}this._setupProperties(m,t[o],p,r[o],n)}else(typeof t[o]>"u"||n)&&(t[o]=a),l||(t[o]*=1),_?r[o]=i[o].slice().reverse():r[o]=t[o]||0}}},s.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},s.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},s.prototype.pause=function(e){return e===void 0&&(e=me()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this)},s.prototype.resume=function(e){return e===void 0&&(e=me()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this)},s.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},s.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},s.prototype.remove=function(){var e;return(e=this._group)===null||e===void 0||e.remove(this),this},s.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},s.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},s.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},s.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},s.prototype.easing=function(e){return e===void 0&&(e=be.Linear.None),this._easingFunction=e,this},s.prototype.interpolation=function(e){return e===void 0&&(e=Le.Linear),this._interpolationFunction=e,this},s.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},s.prototype.onStart=function(e){return this._onStartCallback=e,this},s.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},s.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},s.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},s.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},s.prototype.onStop=function(e){return this._onStopCallback=e,this},s.prototype.update=function(e,t){var i=this,r;if(e===void 0&&(e=me()),t===void 0&&(t=s.autoStartOnUpdate),this._isPaused)return!0;var n;if(!this._goToEnd&&!this._isPlaying)if(t)this.start(e,!0);else return!1;if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var o=e-this._startTime,a=this._duration+((r=this._repeatDelayTime)!==null&&r!==void 0?r:this._delayTime),l=this._duration+this._repeat*a,u=function(){if(i._duration===0||o>l)return 1;var E=Math.trunc(o/a),m=o-E*a,d=Math.min(m/i._duration,1);return d===0&&o===i._duration?1:d},_=u(),p=this._easingFunction(_);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,p),this._onUpdateCallback&&this._onUpdateCallback(this._object,_),this._duration===0||o>=this._duration)if(this._repeat>0){var c=Math.min(Math.trunc((o-this._duration)/a)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=c);for(n in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[n]=="string"&&(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=a*c,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var w=0,f=this._chainedTweens.length;w<f;w++)this._chainedTweens[w].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},s.prototype._updateProperties=function(e,t,i,r){for(var n in i)if(t[n]!==void 0){var o=t[n]||0,a=i[n],l=Array.isArray(e[n]),u=Array.isArray(a),_=!l&&u;_?e[n]=this._interpolationFunction(a,r):typeof a=="object"&&a?this._updateProperties(e[n],o,a,r):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(e[n]=o+(a-o)*r))}},s.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},s.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],i=this._valuesEnd[e];typeof i=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(i):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},s.autoStartOnUpdate=!1,s}();ut.nextId;var U=Fe;U.getAll.bind(U);U.removeAll.bind(U);U.add.bind(U);U.remove.bind(U);U.update.bind(U);const Se=["a","b","c","d","e","f","g","h"],ae=class ae extends xe{constructor(t){super();b(this,"pieces",[]);b(this,"piecesMap",new Map);const i=this.assetsManager.assets.get("OBoard");console.log({board:i});const r=i.scene.clone();r.scale.setScalar(2.1),r.position.y=.235,r.castShadow=!0,r.receiveShadow=!0;let n=new W,o=new W,a=new W,l=new W,u=new W,_=new W;const p=[];for(let m=0;m<r.children.length;m++){const d=r.children[m];d.castShadow=!0,d.receiveShadow=!0,d.name==="Pawn"&&(n=d),d.name==="Rook"&&(o=d),d.name==="Knight"&&(a=d),d.name==="Bishop"&&(l=d),d.name==="King"&&(u=d),d.name==="Queen"&&(_=d),d.name!=="Board"?(d.material.roughness=.9,d.material.metalness=0,p.push(d)):(console.log("BOARD"),d.position.set(0,.235,0),d.material.roughness=.2,d.material.metalness=1,d.scale.setScalar(2.1),this.add(d))}p.forEach(m=>m.removeFromParent());const c=n.material.clone();c.color.setHex(10061943);const w=n.material.clone();w.color.setHex(2228258);for(let m=0;m<8;m++){let d=n.clone(),k=n.clone();this.add(d);let v=t.get(Se[m]+2).position;d.position.set(v.x,v.y+ae.OFFSET_Y,v.z),d.scale.setScalar(2.065),d.material=c,this.piecesMap.set(Se[m]+2,d),this.pieces.push(d),d.name+="new",this.add(k),v=t.get(Se[m]+7).position,k.position.set(v.x,v.y+ae.OFFSET_Y,v.z),k.scale.setScalar(2.065),k.material=w,this.piecesMap.set(Se[m]+7,k),this.pieces.push(k),k.name+="new"}const f=(m,d,k)=>{let v=t.get(d).position;return m.position.set(v.x,v.y+ae.OFFSET_Y,v.z),m.scale.setScalar(2.065),m.material=k,this.add(m),this.pieces.push(m),this.piecesMap.set(d,m),m.name+="new",m};f(o.clone(),"a1",c),f(a.clone(),"b1",c),f(l.clone(),"c1",c),f(_.clone(),"d1",c),f(u.clone(),"e1",c),f(l.clone(),"f1",c),f(a.clone(),"g1",c),f(o.clone(),"h1",c),f(o.clone(),"a8",w);let E=f(a.clone(),"b8",w);E.rotation.y=Math.PI,f(l.clone(),"c8",w),f(_.clone(),"d8",w),f(u.clone(),"e8",w),f(l.clone(),"f8",w),E=f(a.clone(),"g8",w),E.rotation.y=Math.PI,f(o.clone(),"h8",w)}};b(ae,"OFFSET_Y",0);let qe=ae;const oe=2;class cs extends Nt{constructor(){super(),this.map=this.assetsManager.assets.get("stoneWall_Diffuse"),this.map.colorSpace=Tt,this.map.repeat.set(oe,oe),this.map.wrapS=re,this.map.wrapT=re,this.color.set(15641207),this.aoMap=this.assetsManager.assets.get("stoneWall_ARM"),this.aoMap.repeat.set(oe,oe),this.aoMap.wrapS=re,this.aoMap.wrapT=re,this.roughnessMap=this.assetsManager.assets.get("stoneWall_ARM"),this.metalnessMap=this.assetsManager.assets.get("stoneWall_ARM"),this.normalMap=this.assetsManager.assets.get("stoneWall_Normal"),this.normalMap.repeat.set(oe,oe),this.normalMap.wrapS=re,this.normalMap.wrapT=re,this.roughness=.85,this.alphaMap=this.assetsManager.assets.get("roundAlpha"),this.transparent=!0}}class us extends At{constructor(){super();b(this,"debugFolder");const t=new it(18,18,1,1),i=new cs,r=new W(t,i);r.rotation.x=-Math.PI/2,r.receiveShadow=!0,r.castShadow=!0,this.add(r)}}class fs extends It{constructor(){super();b(this,"loop");b(this,"orbit");b(this,"controls");b(this,"controls2");b(this,"selectedObject",null);b(this,"chess",new as);b(this,"piecesMap",new Map);b(this,"cellsMap",new Map);b(this,"highlightedCell",null);b(this,"tween",null);b(this,"tween2",null);b(this,"classicBoard",null);b(this,"modernBoard",null);b(this,"move",()=>{});b(this,"update",()=>{var t,i,r,n,o;super.update(),(t=this.orbit)==null||t.update(),(i=this.controls)==null||i.update(),(r=this.controls2)==null||r.update(),(n=this.tween)==null||n.update(this.loop.elapsed*1e3),(o=this.tween2)==null||o.update(this.loop.elapsed*1e3)});b(this,"createPrototype",async()=>{const t=["a","b","c","d","e","f","g","h"];new Lt(this).map;for(let h=0;h<8;h++)for(let g=0;g<8;g++){const M=new ls(h,g);M.position.y=.35,this.add(M),M.scale.setScalar(1.16),M.position.set((3.5-h)*1.16,.35,(g-3.5)*1.16),this.cellsMap.set(t[h]+(g+1).toString(),M)}const i=new us;this.add(i);const r=new Ft(8);this.add(r),this.camera.position.set(0,15,15),this.orbit=new qt(this.camera,this.gameContext.canvas),this.orbit.enableDamping=!0,this.orbit.minDistance=8,this.orbit.maxDistance=40,this.orbit.maxPolarAngle=Math.PI*.37;const n=new Kt;this.classicBoard=n;const o=new qe(this.cellsMap);this.modernBoard=o,this.add(o);const a=new Wt;this.add(a),this.controls=new $e(n.pieces,this.camera,this.renderer.canvas),this.controls.recursive=!1,this.controls2=new $e(o.pieces,this.camera,this.renderer.canvas),this.controls2.recursive=!1;let l=new X,u=new F,_=new F;const p=new st(new F(0,.1,0),0),c=(h,g)=>{this.highlightedCell&&(this.highlightedCell.visible=!1);const M=new X(Math.floor((h.position.x*g+4.5)/1.16),Math.floor((h.position.z*g+4.5)/1.16)),C=t[7-M.x]+(M.y+1).toString();this.highlightedCell=this.cellsMap.get(C),this.highlightedCell&&(this.highlightedCell.visible=!0,m(C)?this.highlightedCell.markSuccess():this.highlightedCell.markError())};let w=new F,f=null,E=[];const m=h=>E.length!==0&&(E.includes(h)||h===f);let d=!1;const k=h=>{this.orbit.enabled=!1,setTimeout(()=>{w=h.object.position.clone(),d=!0,this.orbit.enabled=!1;const g=h.object.name.includes("new")?1:20;K.setFromCamera(l,this.camera),K.ray.intersectPlane(p,u),_=h.object.position.sub(new F(u.x/g,u.y/g+.5/g,u.z/g)).clone(),h.object.position.set(u.x/g+_.x,u.y/g+.5/g,u.z/g+_.z);const M=new X(Math.floor((h.object.position.x*g+4.5)/1.16),Math.floor((h.object.position.z*g+4.5)/1.16));f=t[7-M.x]+(M.y+1).toString(),E=this.chess.moves({square:f,verbose:!1}).map(C=>C.replace("+","")).map(C=>C.replace("#","").slice(-2)),console.log({moves:E},f,h,this.chess.moves({square:f,verbose:!1})),c(h.object,g)},0)},v=h=>{if(!d)return;K.setFromCamera(l,this.camera),K.ray.intersectPlane(p,u);const g=h.object.name.includes("new")?1:20;h.object.position.set(u.x/g+_.x,u.y/g+.5/g,u.z/g+_.z),c(h.object,g)};let A=0,N=0;const ie=(h,g,M=!1)=>{var ce,ze,Be,Ue,Ke,We;this.chess.move({from:h,to:g});const C=this.piecesMap.get(g),q=this.piecesMap.get(h),P=o.piecesMap.get(g),D=o.piecesMap.get(h);if(console.log("MOVE",this.piecesMap,{currentMesh:q,currentMesh2:D,oldMesh:C,from:h,to:g}),!q||!D)return;const V=this.cellsMap.get(h).position.distanceTo(this.cellsMap.get(g).position);if(M)(ce=this.tween)==null||ce.remove(),(ze=this.tween2)==null||ze.remove(),this.tween=new Je(q.position),this.tween2=new Je(D.position),this.tween2.to(new F(this.cellsMap.get(g).position.x,D.position.y,this.cellsMap.get(g).position.z),V*130).delay(0).start(),this.tween.to(new F(this.cellsMap.get(g).position.x/20,q.position.y,this.cellsMap.get(g).position.z/20),V*130).delay(0).start().onComplete(()=>{var ne,ue,fe,we;if(console.log("DONE"),C&&P){const pe=C.name.includes("white");pe?A++:N++;let Qe=pe?A:N;const He=pe?6.15:-6.15;C.position.x=He/20,C.position.z=(-6.5+Qe)/25,C.position.y=0;const ft=(ne=this.controls)==null?void 0:ne.objects.indexOf(C);(ue=this.controls)==null||ue.objects.splice(ft,1),P.position.x=He,P.position.z=(-6.5+Qe)*.8,P.position.y=0;const pt=(fe=this.controls2)==null?void 0:fe.objects.indexOf(P);(we=this.controls2)==null||we.objects.splice(pt,1)}});else if(q.position.x=this.cellsMap.get(g).position.x/20,q.position.z=this.cellsMap.get(g).position.z/20,D.position.x=this.cellsMap.get(g).position.x,D.position.z=this.cellsMap.get(g).position.z,C&&P){const ne=C.name.includes("white");ne?A++:N++;let ue=ne?A:N;const fe=ne?6.15:-6.15;C.position.x=fe/20,C.position.y=0,C.position.z=(-6.5+ue)/25;const we=(Be=this.controls)==null?void 0:Be.objects.indexOf(C);(Ue=this.controls)==null||Ue.objects.splice(we,1),P.position.x=fe,P.position.z=(-6.5+ue)*.8,P.position.y=0;const pe=(Ke=this.controls2)==null?void 0:Ke.objects.indexOf(P);(We=this.controls2)==null||We.objects.splice(pe,1)}this.piecesMap.set(g,q),o.piecesMap.set(g,D),this.piecesMap.set(h,null),o.piecesMap.set(h,null),console.log(this.chess.ascii())},he=()=>{const h=this.chess.moves({verbose:!0}),M=h.find(C=>C.captured)??h[Math.floor(Math.random()*h.length)];ie(M.from,M.to,!0)},J=h=>{d=!1,this.orbit.enabled=!0;const g=h.object.name.includes("new")?1:20;h.object.position.y=.35/g;const M=new X(Math.floor((h.object.position.x*g+4.5)/1.16),Math.floor((h.object.position.z*g+4.5)/1.16)),C=t[7-M.x]+(M.y+1).toString();console.log("END",{moves:E},C,f),this.highlightedCell?(f!==C&&m(C)?(ie(f,C),setTimeout(he,0),console.log(this.chess.ascii())):(h.object.position.x=w.x,h.object.position.z=w.z),this.highlightedCell.visible=!1,this.highlightedCell=null):(h.object.position.x=w.x,h.object.position.z=w.z)};this.controls.addEventListener("dragstart",k),this.controls.addEventListener("drag",v),this.controls.addEventListener("dragend",J),this.controls2.addEventListener("dragstart",k),this.controls2.addEventListener("drag",v),this.controls2.addEventListener("dragend",J),ke.getInstance().canvas.addEventListener("touchstart",h=>{var C,q,P,D,V,ce;h.preventDefault(),console.log("TOUCH",(q=(C=h.touches)==null?void 0:C[0])==null?void 0:q.clientX);const g=((D=(P=h.touches)==null?void 0:P[0])==null?void 0:D.clientX)/window.innerWidth*2-1,M=-(((ce=(V=h.touches)==null?void 0:V[0])==null?void 0:ce.clientY)/window.innerHeight)*2+1;l.x=g,l.y=M});const K=new tt;ke.getInstance().canvas.addEventListener("pointermove",h=>{h.preventDefault();const g=h.clientX/window.innerWidth*2-1,M=-(h.clientY/window.innerHeight)*2+1;if(l.x=g,l.y=M,this.controls.state!==-1&&this.controls2.state!==-1)return;K.setFromCamera(new X(g,M),this.camera),a.position.set(0,-1,0);const C=K.intersectObjects(n.pieces,!0);if(this.selectedObject&&(this.selectedObject.position.y=.35/20,this.selectedObject=null),C.length>0){let P=C.sort((D,V)=>D.distance-V.distance)[0].object;P.name.includes("piece")||(P=P.parent),this.selectedObject=P,a.position.set(P.position.x*20,.35,P.position.z*20)}}),console.log("TestLevelScene constructor");for(let h=0;h<8;h++)for(let g=0;g<8;g++)this.piecesMap.set(t[g]+(h+1).toString(),null);this.piecesMap.set("h1",n.pieces.find(({name:h})=>h==="piece_rook_white_02")??null),this.piecesMap.set("g1",n.pieces.find(({name:h})=>h==="piece_knight_white_02")??null),this.piecesMap.set("f1",n.pieces.find(({name:h})=>h==="piece_bishop_white_02")??null),this.piecesMap.set("e1",n.pieces.find(({name:h})=>h==="piece_king_white")??null),this.piecesMap.set("d1",n.pieces.find(({name:h})=>h==="piece_queen_white")??null),this.piecesMap.set("c1",n.pieces.find(({name:h})=>h==="piece_bishop_white_01")??null),this.piecesMap.set("b1",n.pieces.find(({name:h})=>h==="piece_knight_white_01")??null),this.piecesMap.set("a1",n.pieces.find(({name:h})=>h==="piece_rook_white_01")??null);for(let h=0;h<8;h++)this.piecesMap.set(t[h]+"2",n.pieces.find(({name:g})=>g==="piece_pawn_white_0"+(h+1))??null);this.piecesMap.set("h8",n.pieces.find(({name:h})=>h==="piece_rook_black_01")??null),this.piecesMap.set("g8",n.pieces.find(({name:h})=>h==="piece_knight_black_01")??null),this.piecesMap.set("f8",n.pieces.find(({name:h})=>h==="piece_bishop_black_01")??null),this.piecesMap.set("e8",n.pieces.find(({name:h})=>h==="piece_king_black")??null),this.piecesMap.set("d8",n.pieces.find(({name:h})=>h==="piece_queen_black")??null),this.piecesMap.set("c8",n.pieces.find(({name:h})=>h==="piece_bishop_black_02")??null),this.piecesMap.set("b8",n.pieces.find(({name:h})=>h==="piece_knight_black_02")??null),this.piecesMap.set("a8",n.pieces.find(({name:h})=>h==="piece_rook_black_02")??null);for(let h=0;h<8;h++)this.piecesMap.set(t[h]+"7",n.pieces.find(({name:g})=>g==="piece_pawn_black_0"+(8-h))??null);console.log(this.piecesMap),he()});this.gameContext.assetsManager.addEventListener(nt.LOAD_COMPLETE,this.createPrototype),this.loop=this.gameContext.loop,Ot.isActive=!1}classic(t){t?(this.add(this.classicBoard),this.remove(this.modernBoard),this.controls.enabled=!0,this.controls2.enabled=!1):(this.add(this.modernBoard),this.remove(this.classicBoard),this.controls.enabled=!1,this.controls2.enabled=!0)}createCamera(){return new Dt().camera}createRenderer(){return new Ut(this.gameContext.canvas,this,this.camera,this.gameContext.size)}dispose(){var t,i;super.dispose(),(t=this.tween)==null||t.remove(),(i=this.tween2)==null||i.remove()}}class ps extends Rt{constructor(t){console.log("Create chess game");super(t);b(this,"resize",()=>{this.scene.resize()});this.loadLevelScene(new fs),ke.getInstance().size.addEventListener(jt.RESIZE_EVENT,this.resize)}createDebug(){}createAssetsManager(){return new nt(Bt)}classic(t){this.scene.classic(t)}}let Ve;const ms=()=>{const s=ee.useRef(null),e=ee.useRef(null),[t,i]=ee.useState(.01),[r,n]=ee.useState(!1),[o,a]=ee.useState(!0);return ee.useEffect(()=>{s.current&&!e.current&&(console.log("CREATE chess"),e.current=new ps(s.current),Ve=setInterval(()=>{i(l=>Math.min(ke.getInstance().assetsManager.progress,l+.5))},100))},[]),ee.useEffect(()=>{t===1&&clearInterval(Ve)},[t]),console.log({progress:t}),z.jsxs("div",{style:{position:"relative"},className:"chess-page",children:[z.jsxs("div",{style:{background:"#111111",position:"fixed",width:"100vw",height:"100vh",color:"white",fontSize:"2rem",display:t<1?"flex":"none",alignItems:"center",justifyContent:"center"},children:[z.jsx("div",{className:"progressShadow"}),z.jsxs("div",{children:[z.jsx("div",{className:"progress"}),z.jsx("div",{className:"progressBar",style:{width:`${t*19.5}rem`}})]})]}),t>=1&&z.jsxs("button",{className:"change-btn",onClick:()=>{var l;n(u=>!u),(l=e.current)==null||l.classic(!r)},children:[z.jsx("div",{className:"outer-glow"}),z.jsx("div",{className:"content",children:r?"Classic":"Modern"})]}),t>=1&&z.jsx(zt,{title:"Change Board"}),z.jsx("canvas",{ref:s,className:"webgl-game",style:{touchAction:"none"}})]})};export{ms as default};
