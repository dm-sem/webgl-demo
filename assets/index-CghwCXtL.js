var _t=Object.defineProperty;var gt=(s,e,t)=>e in s?_t(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var m=(s,e,t)=>gt(s,typeof e!="symbol"?e+"":e,t);import{W as mt,V as vt,A as bt,E as wt,d as Et,e as yt,f as St,g as Ct,h as $e,G as Mt,T as kt,a6 as tt,m as xt,M as G,a7 as Pt,p as st,a8 as de,a9 as Te,z as Z,aa as it,o as q,y as Tt,k as nt,i as At,j as re,ab as Rt,_ as It,$ as rt,D as Ot,a2 as ke,a1 as jt,a3 as Nt,a4 as W,a5 as k}from"./index-CQDLqIDR.js";import{A as Pe,S as Dt,a as Lt,E as qt,b as Ft,O as zt,D as Bt}from"./Description-CPkinzfy.js";const Ut=[{name:"outlineAlpha",type:"texture",path:"/textures/outlineAlpha.jpg"},{name:"envMap3",type:"rgbe",path:"/textures/envMaps/4.hdr"},{name:"roundAlpha",type:"texture",path:"/textures/alpha.jpg"},{name:"particle",type:"texture",path:"/textures/particle.png"},{name:"woodenPlanks_Diffuse",type:"texture",path:"/textures/woodenPlanks/diff_1k.jpg"},{name:"woodenPlanks_ARM",type:"texture",path:"/textures/woodenPlanks/arm_1k.jpg"},{name:"woodenPlanks_Normal",type:"texture",path:"/textures/woodenPlanks/normal_1k.jpg"},{name:"stoneWall_Diffuse",type:"texture",path:"/textures/stoneWall/plastered_stone_wall_diff_1k.jpg"},{name:"stoneWall_ARM",type:"texture",path:"/textures/stoneWall/plastered_stone_wall_arm_1k.jpg"},{name:"stoneWall_Normal",type:"texture",path:"/textures/stoneWall/plastered_stone_wall_nor_gl_1k.jpg"},{name:"pavement_Diffuse",type:"texture",path:"/textures/pavement/pavement_02_diff_1k.jpg"},{name:"pavement_ARM",type:"texture",path:"/textures/pavement/pavement_02_arm_1k.jpg"},{name:"pavement_Normal",type:"texture",path:"/textures/pavement/pavement_02_nor_gl_1k.jpg"},{name:"testBoard",type:"gltf",path:"/models/chess/testBoard/chess_set_1k/chess_set_1k.gltf"},{name:"OBoard",type:"gltf",path:"/models/chess/OBoard2.glb"}];class Kt{constructor(e,t,i,r){m(this,"camera");m(this,"scene");m(this,"canvas");m(this,"size");m(this,"renderer");m(this,"effectComposer");m(this,"renderPass");m(this,"resize",()=>{this.renderer.setSize(this.size.width,this.size.height),this.renderer.setPixelRatio(this.size.pixelRatio)});m(this,"update",()=>{this.effectComposer.render()});this.canvas=e,this.scene=t,this.camera=i,this.size=r,this.renderer=new mt({canvas:this.canvas,antialias:!0}),this.resize(),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=vt,this.renderer.toneMapping=bt,this.renderer.toneMappingExposure=1,this.effectComposer=new wt(this.renderer),this.effectComposer.setPixelRatio(this.size.pixelRatio),this.effectComposer.setSize(this.size.width,this.size.height),this.renderPass=new Et(this.scene,this.camera),this.effectComposer.addPass(this.renderPass);const n=new yt;n.strength=.4,n.threshold=2.5,this.effectComposer.addPass(n);const o=new St(5,this.scene,this.camera);o.normalEdgeStrength=0,o.enabled=!1,this.effectComposer.addPass(o);const a=new Ct(this.scene,this.camera);a.params.saoScale=4,a.params.saoIntensity=.08,a.params.saoKernelRadius=30,a.params.saoBlurRadius=3,this.effectComposer.addPass(a),a.enabled=!1;const h={uniforms:{tDiffuse:{type:"t",value:null},width:{type:"f",value:0},height:{type:"f",value:0},kernel:{type:"fv1",value:[-1,-1,-1,-1,9,-1,-1,-1,-1]}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float width;","uniform float height;","uniform float kernel[9];","void main(void)","{","float step_w = 1.0/width;","float step_h = 1.0/height;","vec2 offset[9];","offset[0] = vec2(-step_w, -step_h);","offset[1] = vec2(0.0, -step_h);","offset[2] = vec2(step_w, -step_h);","offset[3] = vec2(-step_w, 0.0);","offset[4] = vec2(0.0, 0.0);","offset[5] = vec2(step_w, 0.0);","offset[6] = vec2(-step_w, step_h);","offset[7] = vec2(0.0, step_h);","offset[8] = vec2(step_w, step_h);","vec3 sum = vec3(0.0);","for( int i=0; i<9; i++ )","sum += texture2D(tDiffuse, vUv + offset[i] * 0.095).rgb * kernel[i];","gl_FragColor = vec4(sum,1.0);","}"].join(`
`)},u=new $e(h);u.uniforms.width.value=window.innerWidth,u.uniforms.height.value=window.innerHeight,u.enabled=!1,this.effectComposer.addPass(u);const d=new $e(Mt);this.effectComposer.addPass(d),d.enabled=!1,this.effectComposer.renderTarget1.samples=4,this.effectComposer.renderTarget2.samples=4}dispose(){this.renderer.dispose()}}class Wt extends Pe{constructor(){super();m(this,"pieces",[]);const t=this.assetsManager.assets.get("testBoard");this.add(t.scene),console.log(t.scene),t.scene.castShadow=!0,t.scene.receiveShadow=!0;for(let p=0;p<t.scene.children.length;p++){const c=t.scene.children[p];c.castShadow=!0,c.receiveShadow=!0,c.name.includes("piece")&&(c.type==="Group"&&(t.scene.children[p]=c.children[0],t.scene.children[p].name=c.name,t.scene.children[p].position.add(c.position),t.scene.children[p].matrix=c.matrix,t.scene.children[p].parent=c.parent,t.scene.children[p].updateMatrixWorld(!0),t.scene.children[p].castShadow=!0,t.scene.children[p].receiveShadow=!0),this.pieces.push(t.scene.children[p]))}const i=this.pieces.find(({name:p})=>p==="piece_king_white"),r=this.pieces.find(({name:p})=>p==="piece_queen_white"),n=i.position.clone(),o=r.position.clone();i.position.set(o.x,o.y,o.z),r.position.set(n.x,n.y,n.z);const a=this.pieces.find(({name:p})=>p==="piece_king_black"),h=this.pieces.find(({name:p})=>p==="piece_queen_black"),u=a.position.clone(),d=h.position.clone();a.position.set(d.x,d.y,d.z),h.position.set(u.x,u.y,u.z),t.scene.scale.setScalar(20)}}class Gt extends Pe{constructor(){super();const e=new kt(.5,.005,64),t=new tt({color:3407701,side:xt,emissive:3407701,emissiveIntensity:5}),i=new G(e,t);i.rotation.x=Math.PI/2,this.visible=!1,this.add(i)}}const he=new it,Q=new Z,ot=new q,Ae=new Z,Ce=new Z,xe=new q,Ne=new q,at=new Tt,ht=new q,lt=new q;let N=null,B=null;const H=[],J={NONE:-1,PAN:0,ROTATE:1};class Ye extends Pt{constructor(e,t,i=null){super(t,i),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new st,this.mouseButtons={LEFT:de.PAN,MIDDLE:de.PAN,RIGHT:de.ROTATE},this.touches={ONE:Te.PAN},this._onPointerMove=Qt.bind(this),this._onPointerDown=Ht.bind(this),this._onPointerCancel=$t.bind(this),this._onContextMenu=Yt.bind(this),i!==null&&this.connect()}connect(){this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const t=this.domElement.getBoundingClientRect();Q.x=(e.clientX-t.left)/t.width*2-1,Q.y=-(e.clientY-t.top)/t.height*2+1}_updateState(e){let t;if(e.pointerType==="touch")t=this.touches.ONE;else switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=null}switch(t){case de.PAN:case Te.PAN:this.state=J.PAN;break;case de.ROTATE:case Te.ROTATE:this.state=J.ROTATE;break;default:this.state=J.NONE}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(e){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=e}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(e){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function Qt(s){const e=this.object,t=this.domElement,i=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(s),i.setFromCamera(Q,e),N)this.state===J.PAN?i.ray.intersectPlane(he,xe)&&N.position.copy(xe.sub(ot).applyMatrix4(at)):this.state===J.ROTATE&&(Ae.subVectors(Q,Ce).multiplyScalar(this.rotateSpeed),N.rotateOnWorldAxis(ht,Ae.x),N.rotateOnWorldAxis(lt.normalize(),-Ae.y)),this.dispatchEvent({type:"drag",object:N}),Ce.copy(Q);else if(s.pointerType==="mouse"||s.pointerType==="pen")if(H.length=0,i.setFromCamera(Q,e),i.intersectObjects(this.objects,this.recursive,H),H.length>0){const r=H[0].object;he.setFromNormalAndCoplanarPoint(e.getWorldDirection(he.normal),Ne.setFromMatrixPosition(r.matrixWorld)),B!==r&&B!==null&&(this.dispatchEvent({type:"hoveroff",object:B}),t.style.cursor="auto",B=null),B!==r&&(this.dispatchEvent({type:"hoveron",object:r}),t.style.cursor="pointer",B=r)}else B!==null&&(this.dispatchEvent({type:"hoveroff",object:B}),t.style.cursor="auto",B=null);Ce.copy(Q)}}function Ht(s){const e=this.object,t=this.domElement,i=this.raycaster;this.enabled!==!1&&(this._updatePointer(s),this._updateState(s),H.length=0,i.setFromCamera(Q,e),i.intersectObjects(this.objects,this.recursive,H),H.length>0&&(this.transformGroup===!0?N=ct(H[0].object):N=H[0].object,he.setFromNormalAndCoplanarPoint(e.getWorldDirection(he.normal),Ne.setFromMatrixPosition(N.matrixWorld)),i.ray.intersectPlane(he,xe)&&(this.state===J.PAN?(at.copy(N.parent.matrixWorld).invert(),ot.copy(xe).sub(Ne.setFromMatrixPosition(N.matrixWorld))):this.state===J.ROTATE&&(ht.set(0,1,0).applyQuaternion(e.quaternion).normalize(),lt.set(1,0,0).applyQuaternion(e.quaternion).normalize())),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:N})),Ce.copy(Q))}function $t(){this.enabled!==!1&&(N&&(this.dispatchEvent({type:"dragend",object:N}),N=null),this.domElement.style.cursor=B?"pointer":"auto",this.state=J.NONE)}function Yt(s){this.enabled!==!1&&s.preventDefault()}function ct(s,e=null){return s.isGroup&&(e=s),s.parent===null?e:ct(s.parent,e)}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const I="w",L="b",A="p",De="n",Me="b",ge="r",X="q",T="k",Re="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class Ee{constructor(e,t){m(this,"color");m(this,"from");m(this,"to");m(this,"piece");m(this,"captured");m(this,"promotion");m(this,"flags");m(this,"san");m(this,"lan");m(this,"before");m(this,"after");const{color:i,piece:r,from:n,to:o,flags:a,captured:h,promotion:u}=t,d=O(n),p=O(o);this.color=i,this.piece=r,this.from=d,this.to=p,this.san=e._moveToSan(t,e._moves({legal:!0})),this.lan=d+p,this.before=e.fen(),e._makeMove(t),this.after=e.fen(),e._undoMove(),this.flags="";for(const c in S)S[c]&a&&(this.flags+=te[c]);h&&(this.captured=h),u&&(this.promotion=u,this.lan+=u)}isCapture(){return this.flags.indexOf(te.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(te.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(te.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(te.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(te.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(te.BIG_PAWN)>-1}}const j=-1,te={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},S={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},y={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Ie={b:[16,32,17,15],w:[-16,-32,-17,-15]},Xe={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Xt=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Zt=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Jt={p:1,n:2,b:4,r:8,q:16,k:32},Vt="pnbrqkPNBRQK",Ze=[De,Me,ge,X],es=7,ts=6,ss=1,is=0,ye={[T]:S.KSIDE_CASTLE,[X]:S.QSIDE_CASTLE},$={w:[{square:y.a1,flag:S.QSIDE_CASTLE},{square:y.h1,flag:S.KSIDE_CASTLE}],b:[{square:y.a8,flag:S.QSIDE_CASTLE},{square:y.h8,flag:S.KSIDE_CASTLE}]},ns={b:ss,w:ts},rs=["1-0","0-1","1/2-1/2","*"];function se(s){return s>>4}function be(s){return s&15}function ut(s){return"0123456789".indexOf(s)!==-1}function O(s){const e=be(s),t=se(s);return"abcdefgh".substring(e,e+1)+"87654321".substring(t,t+1)}function _e(s){return s===I?L:I}function os(s){const e=s.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const t=parseInt(e[5],10);if(isNaN(t)||t<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const i=parseInt(e[4],10);if(isNaN(i)||i<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const r=e[0].split("/");if(r.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let o=0;o<r.length;o++){let a=0,h=!1;for(let u=0;u<r[o].length;u++)if(ut(r[o][u])){if(h)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};a+=parseInt(r[o][u],10),h=!0}else{if(!/^[prnbqkPRNBQK]$/.test(r[o][u]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};a+=1,h=!1}if(a!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const n=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:o,regex:a}of n){if(!a.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${o} king`};if((e[0].match(a)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${o} kings`}}return Array.from(r[0]+r[7]).some(o=>o.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function as(s,e){const t=s.from,i=s.to,r=s.piece;let n=0,o=0,a=0;for(let h=0,u=e.length;h<u;h++){const d=e[h].from,p=e[h].to,c=e[h].piece;r===c&&t!==d&&i===p&&(n++,se(t)===se(d)&&o++,be(t)===be(d)&&a++)}return n>0?o>0&&a>0?O(t):a>0?O(t).charAt(1):O(t).charAt(0):""}function Y(s,e,t,i,r,n=void 0,o=S.NORMAL){const a=se(i);if(r===A&&(a===es||a===is))for(let h=0;h<Ze.length;h++){const u=Ze[h];s.push({color:e,from:t,to:i,piece:r,captured:n,promotion:u,flags:o|S.PROMOTION})}else s.push({color:e,from:t,to:i,piece:r,captured:n,flags:o})}function Je(s){let e=s.charAt(0);return e>="a"&&e<="h"?s.match(/[a-h]\d.*[a-h]\d/)?void 0:A:(e=e.toLowerCase(),e==="o"?T:e)}function Oe(s){return s.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function je(s){return s.split(" ").slice(0,4).join(" ")}class hs{constructor(e=Re,{skipValidation:t=!1}={}){m(this,"_board",new Array(128));m(this,"_turn",I);m(this,"_header",{});m(this,"_kings",{w:j,b:j});m(this,"_epSquare",-1);m(this,"_halfMoves",0);m(this,"_moveNumber",0);m(this,"_history",[]);m(this,"_comments",{});m(this,"_castling",{w:0,b:0});m(this,"_positionCount",{});this.load(e,{skipValidation:t})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:j,b:j},this._turn=I,this._castling={w:0,b:0},this._epSquare=j,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{},this._positionCount={},delete this._header.SetUp,delete this._header.FEN}load(e,{skipValidation:t=!1,preserveHeaders:i=!1}={}){let r=e.split(/\s+/);if(r.length>=2&&r.length<6){const a=["-","-","0","1"];e=r.concat(a.slice(-(6-r.length))).join(" ")}if(r=e.split(/\s+/),!t){const{ok:a,error:h}=os(e);if(!a)throw new Error(h)}const n=r[0];let o=0;this.clear({preserveHeaders:i});for(let a=0;a<n.length;a++){const h=n.charAt(a);if(h==="/")o+=8;else if(ut(h))o+=parseInt(h,10);else{const u=h<"a"?I:L;this._put({type:h.toLowerCase(),color:u},O(o)),o++}}this._turn=r[1],r[2].indexOf("K")>-1&&(this._castling.w|=S.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(this._castling.w|=S.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(this._castling.b|=S.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(this._castling.b|=S.QSIDE_CASTLE),this._epSquare=r[3]==="-"?j:y[r[3]],this._halfMoves=parseInt(r[4],10),this._moveNumber=parseInt(r[5],10),this._updateSetup(e),this._incPositionCount(e)}fen(){var n,o;let e=0,t="";for(let a=y.a8;a<=y.h1;a++){if(this._board[a]){e>0&&(t+=e,e=0);const{color:h,type:u}=this._board[a];t+=h===I?u.toUpperCase():u.toLowerCase()}else e++;a+1&136&&(e>0&&(t+=e),a!==y.h1&&(t+="/"),e=0,a+=8)}let i="";this._castling[I]&S.KSIDE_CASTLE&&(i+="K"),this._castling[I]&S.QSIDE_CASTLE&&(i+="Q"),this._castling[L]&S.KSIDE_CASTLE&&(i+="k"),this._castling[L]&S.QSIDE_CASTLE&&(i+="q"),i=i||"-";let r="-";if(this._epSquare!==j){const a=this._epSquare+(this._turn===I?16:-16),h=[a+1,a-1];for(const u of h){if(u&136)continue;const d=this._turn;if(((n=this._board[u])==null?void 0:n.color)===d&&((o=this._board[u])==null?void 0:o.type)===A){this._makeMove({color:d,from:u,to:this._epSquare,piece:A,captured:A,flags:S.EP_CAPTURE});const p=!this._isKingAttacked(d);if(this._undoMove(),p){r=O(this._epSquare);break}}}}return[t,this._turn,i,r,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==Re?(this._header.SetUp="1",this._header.FEN=e):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(Re)}get(e){return this._board[y[e]]}put({type:e,color:t},i){return this._put({type:e,color:t},i)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_put({type:e,color:t},i){if(Vt.indexOf(e.toLowerCase())===-1||!(i in y))return!1;const r=y[i];if(e==T&&!(this._kings[t]==j||this._kings[t]==r))return!1;const n=this._board[r];return n&&n.type===T&&(this._kings[n.color]=j),this._board[r]={type:e,color:t},e===T&&(this._kings[t]=r),!0}remove(e){const t=this.get(e);return delete this._board[y[e]],t&&t.type===T&&(this._kings[t.color]=j),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){var i,r,n,o,a,h,u,d,p,c,w,f;const e=((i=this._board[y.e1])==null?void 0:i.type)===T&&((r=this._board[y.e1])==null?void 0:r.color)===I,t=((n=this._board[y.e8])==null?void 0:n.type)===T&&((o=this._board[y.e8])==null?void 0:o.color)===L;(!e||((a=this._board[y.a1])==null?void 0:a.type)!==ge||((h=this._board[y.a1])==null?void 0:h.color)!==I)&&(this._castling.w&=-65),(!e||((u=this._board[y.h1])==null?void 0:u.type)!==ge||((d=this._board[y.h1])==null?void 0:d.color)!==I)&&(this._castling.w&=-33),(!t||((p=this._board[y.a8])==null?void 0:p.type)!==ge||((c=this._board[y.a8])==null?void 0:c.color)!==L)&&(this._castling.b&=-65),(!t||((w=this._board[y.h8])==null?void 0:w.type)!==ge||((f=this._board[y.h8])==null?void 0:f.color)!==L)&&(this._castling.b&=-33)}_updateEnPassantSquare(){var n,o;if(this._epSquare===j)return;const e=this._epSquare+(this._turn===I?-16:16),t=this._epSquare+(this._turn===I?16:-16),i=[t+1,t-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((n=this._board[t])==null?void 0:n.color)!==_e(this._turn)||((o=this._board[t])==null?void 0:o.type)!==A){this._epSquare=j;return}const r=a=>{var h,u;return!(a&136)&&((h=this._board[a])==null?void 0:h.color)===this._turn&&((u=this._board[a])==null?void 0:u.type)===A};i.some(r)||(this._epSquare=j)}_attacked(e,t,i){const r=[];for(let n=y.a8;n<=y.h1;n++){if(n&136){n+=7;continue}if(this._board[n]===void 0||this._board[n].color!==e)continue;const o=this._board[n],a=n-t;if(a===0)continue;const h=a+119;if(Xt[h]&Jt[o.type]){if(o.type===A){if(a>0&&o.color===I||a<=0&&o.color===L)if(i)r.push(O(n));else return!0;continue}if(o.type==="n"||o.type==="k")if(i){r.push(O(n));continue}else return!0;const u=Zt[h];let d=n+u,p=!1;for(;d!==t;){if(this._board[d]!=null){p=!0;break}d+=u}if(!p)if(i){r.push(O(n));continue}else return!0}}return i?r:!1}attackers(e,t){return t?this._attacked(t,y[e],!0):this._attacked(this._turn,y[e],!0)}_isKingAttacked(e){const t=this._kings[e];return t===-1?!1:this._attacked(_e(e),t)}isAttacked(e,t){return this._attacked(t,y[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},t=[];let i=0,r=0;for(let n=y.a8;n<=y.h1;n++){if(r=(r+1)%2,n&136){n+=7;continue}const o=this._board[n];o&&(e[o.type]=o.type in e?e[o.type]+1:1,o.type===Me&&t.push(r),i++)}if(i===2)return!0;if(i===3&&(e[Me]===1||e[De]===1))return!0;if(i===e[Me]+2){let n=0;const o=t.length;for(let a=0;a<o;a++)n+=t[a];if(n===0||n===o)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this.fen())>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:t=void 0,piece:i=void 0}={}){const r=this._moves({square:t,piece:i});return e?r.map(n=>new Ee(this,n)):r.map(n=>this._moveToSan(n,r))}_moves({legal:e=!0,piece:t=void 0,square:i=void 0}={}){var w;const r=i?i.toLowerCase():void 0,n=t==null?void 0:t.toLowerCase(),o=[],a=this._turn,h=_e(a);let u=y.a8,d=y.h1,p=!1;if(r)if(r in y)u=d=y[r],p=!0;else return[];for(let f=u;f<=d;f++){if(f&136){f+=7;continue}if(!this._board[f]||this._board[f].color===h)continue;const{type:E}=this._board[f];let v;if(E===A){if(n&&n!==E)continue;v=f+Ie[a][0],this._board[v]||(Y(o,a,f,v,A),v=f+Ie[a][1],ns[a]===se(f)&&!this._board[v]&&Y(o,a,f,v,A,void 0,S.BIG_PAWN));for(let _=2;_<4;_++)v=f+Ie[a][_],!(v&136)&&(((w=this._board[v])==null?void 0:w.color)===h?Y(o,a,f,v,A,this._board[v].type,S.CAPTURE):v===this._epSquare&&Y(o,a,f,v,A,A,S.EP_CAPTURE))}else{if(n&&n!==E)continue;for(let _=0,x=Xe[E].length;_<x;_++){const b=Xe[E][_];for(v=f;v+=b,!(v&136);){if(!this._board[v])Y(o,a,f,v,E);else{if(this._board[v].color===a)break;Y(o,a,f,v,E,this._board[v].type,S.CAPTURE);break}if(E===De||E===T)break}}}}if((n===void 0||n===T)&&(!p||d===this._kings[a])){if(this._castling[a]&S.KSIDE_CASTLE){const f=this._kings[a],E=f+2;!this._board[f+1]&&!this._board[E]&&!this._attacked(h,this._kings[a])&&!this._attacked(h,f+1)&&!this._attacked(h,E)&&Y(o,a,this._kings[a],E,T,void 0,S.KSIDE_CASTLE)}if(this._castling[a]&S.QSIDE_CASTLE){const f=this._kings[a],E=f-2;!this._board[f-1]&&!this._board[f-2]&&!this._board[f-3]&&!this._attacked(h,this._kings[a])&&!this._attacked(h,f-1)&&!this._attacked(h,E)&&Y(o,a,this._kings[a],E,T,void 0,S.QSIDE_CASTLE)}}if(!e||this._kings[a]===-1)return o;const c=[];for(let f=0,E=o.length;f<E;f++)this._makeMove(o[f]),this._isKingAttacked(a)||c.push(o[f]),this._undoMove();return c}move(e,{strict:t=!1}={}){let i=null;if(typeof e=="string")i=this._moveFromSan(e,t);else if(typeof e=="object"){const n=this._moves();for(let o=0,a=n.length;o<a;o++)if(e.from===O(n[o].from)&&e.to===O(n[o].to)&&(!("promotion"in n[o])||e.promotion===n[o].promotion)){i=n[o];break}}if(!i)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);const r=new Ee(this,i);return this._makeMove(i),this._incPositionCount(r.after),r}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){const t=this._turn,i=_e(t);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&S.EP_CAPTURE&&(this._turn===L?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:t}),this._board[e.to].type===T){if(this._kings[t]=e.to,e.flags&S.KSIDE_CASTLE){const r=e.to-1,n=e.to+1;this._board[r]=this._board[n],delete this._board[n]}else if(e.flags&S.QSIDE_CASTLE){const r=e.to+1,n=e.to-2;this._board[r]=this._board[n],delete this._board[n]}this._castling[t]=0}if(this._castling[t]){for(let r=0,n=$[t].length;r<n;r++)if(e.from===$[t][r].square&&this._castling[t]&$[t][r].flag){this._castling[t]^=$[t][r].flag;break}}if(this._castling[i]){for(let r=0,n=$[i].length;r<n;r++)if(e.to===$[i][r].square&&this._castling[i]&$[i][r].flag){this._castling[i]^=$[i][r].flag;break}}e.flags&S.BIG_PAWN?t===L?this._epSquare=e.to-16:this._epSquare=e.to+16:this._epSquare=j,e.piece===A?this._halfMoves=0:e.flags&(S.CAPTURE|S.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===L&&this._moveNumber++,this._turn=i}undo(){const e=this._undoMove();if(e){const t=new Ee(this,e);return this._decPositionCount(t.after),t}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;const t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;const i=this._turn,r=_e(i);if(this._board[t.from]=this._board[t.to],this._board[t.from].type=t.piece,delete this._board[t.to],t.captured)if(t.flags&S.EP_CAPTURE){let n;i===L?n=t.to-16:n=t.to+16,this._board[n]={type:A,color:r}}else this._board[t.to]={type:t.captured,color:r};if(t.flags&(S.KSIDE_CASTLE|S.QSIDE_CASTLE)){let n,o;t.flags&S.KSIDE_CASTLE?(n=t.to+1,o=t.to-1):(n=t.to-2,o=t.to+1),this._board[n]=this._board[o],delete this._board[o]}return t}pgn({newline:e=`
`,maxWidth:t=0}={}){const i=[];let r=!1;for(const c in this._header)i.push("["+c+' "'+this._header[c]+'"]'+e),r=!0;r&&this._history.length&&i.push(e);const n=c=>{const w=this._comments[this.fen()];if(typeof w<"u"){const f=c.length>0?" ":"";c=`${c}${f}{${w}}`}return c},o=[];for(;this._history.length>0;)o.push(this._undoMove());const a=[];let h="";for(o.length===0&&a.push(n(""));o.length>0;){h=n(h);const c=o.pop();if(!c)break;if(!this._history.length&&c.color==="b"){const w=`${this._moveNumber}. ...`;h=h?`${h} ${w}`:w}else c.color==="w"&&(h.length&&a.push(h),h=this._moveNumber+".");h=h+" "+this._moveToSan(c,this._moves({legal:!0})),this._makeMove(c)}if(h.length&&a.push(n(h)),typeof this._header.Result<"u"&&a.push(this._header.Result),t===0)return i.join("")+a.join(" ");const u=function(){return i.length>0&&i[i.length-1]===" "?(i.pop(),!0):!1},d=function(c,w){for(const f of w.split(" "))if(f){if(c+f.length>t){for(;u();)c--;i.push(e),c=0}i.push(f),c+=f.length,i.push(" "),c++}return u()&&c--,c};let p=0;for(let c=0;c<a.length;c++){if(p+a[c].length>t&&a[c].includes("{")){p=d(p,a[c]);continue}p+a[c].length>t&&c!==0?(i[i.length-1]===" "&&i.pop(),i.push(e),p=0):c!==0&&(i.push(" "),p++),i.push(a[c]),p+=a[c].length}return i.join("")}header(...e){for(let t=0;t<e.length;t+=2)typeof e[t]=="string"&&typeof e[t+1]=="string"&&(this._header[e[t]]=e[t+1]);return this._header}setHeader(e,t){return this._header[e]=t,this._header}removeHeader(e){return e in this._header?(delete this._header[e],!0):!1}getHeaders(){return this._header}loadPgn(e,{strict:t=!1,newlineChar:i=`\r?
`}={}){function r(b){return b.replace(/\\/g,"\\")}function n(b){const R={},D=b.split(new RegExp(r(i)));let ie="",le="";for(let V=0;V<D.length;V++){const K=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;ie=D[V].replace(K,"$1"),le=D[V].replace(K,"$2"),ie.trim().length>0&&(R[ie]=le)}return R}e=e.trim();const a=new RegExp("^(\\[((?:"+r(i)+")|.)*\\])((?:\\s*"+r(i)+"){2}|(?:\\s*"+r(i)+")*$)").exec(e),h=a&&a.length>=2?a[1]:"";this.reset();const u=n(h);let d="";for(const b in u)b.toLowerCase()==="fen"&&(d=u[b]),this.header(b,u[b]);if(!t)d&&this.load(d,{preserveHeaders:!0});else if(u.SetUp==="1"){if(!("FEN"in u))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(u.FEN,{preserveHeaders:!0})}function p(b){return Array.from(b).map(function(R){return R.charCodeAt(0)<128?R.charCodeAt(0).toString(16):encodeURIComponent(R).replace(/%/g,"").toLowerCase()}).join("")}function c(b){return b.length==0?"":decodeURIComponent("%"+(b.match(/.{1,2}/g)||[]).join("%"))}const w=function(b){return b=b.replace(new RegExp(r(i),"g")," "),`{${p(b.slice(1,b.length-1))}}`},f=function(b){if(b.startsWith("{")&&b.endsWith("}"))return c(b.slice(1,b.length-1))};let E=e.replace(h,"").replace(new RegExp(`({[^}]*})+?|;([^${r(i)}]*)`,"g"),function(b,R,D){return R!==void 0?w(R):" "+w(`{${D.slice(1)}}`)}).replace(new RegExp(r(i),"g")," ");const v=/(\([^()]+\))+?/g;for(;v.test(E);)E=E.replace(v,"");E=E.replace(/\d+\.(\.\.)?/g,""),E=E.replace(/\.\.\./g,""),E=E.replace(/\$\d+/g,"");let _=E.trim().split(new RegExp(/\s+/));_=_.filter(b=>b!=="");let x="";for(let b=0;b<_.length;b++){const R=f(_[b]);if(R!==void 0){this._comments[this.fen()]=R;continue}const D=this._moveFromSan(_[b],t);if(D==null)if(rs.indexOf(_[b])>-1)x=_[b];else throw new Error(`Invalid move in PGN: ${_[b]}`);else x="",this._makeMove(D),this._incPositionCount(this.fen())}x&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",x)}_moveToSan(e,t){let i="";if(e.flags&S.KSIDE_CASTLE)i="O-O";else if(e.flags&S.QSIDE_CASTLE)i="O-O-O";else{if(e.piece!==A){const r=as(e,t);i+=e.piece.toUpperCase()+r}e.flags&(S.CAPTURE|S.EP_CAPTURE)&&(e.piece===A&&(i+=O(e.from)[0]),i+="x"),i+=O(e.to),e.promotion&&(i+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?i+="#":i+="+"),this._undoMove(),i}_moveFromSan(e,t=!1){const i=Oe(e);let r=Je(i),n=this._moves({legal:!0,piece:r});for(let c=0,w=n.length;c<w;c++)if(i===Oe(this._moveToSan(n[c],n)))return n[c];if(t)return null;let o,a,h,u,d,p=!1;if(a=i.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),a?(o=a[1],h=a[2],u=a[3],d=a[4],h.length==1&&(p=!0)):(a=i.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),a&&(o=a[1],h=a[2],u=a[3],d=a[4],h.length==1&&(p=!0))),r=Je(i),n=this._moves({legal:!0,piece:o||r}),!u)return null;for(let c=0,w=n.length;c<w;c++)if(h){if((!o||o.toLowerCase()==n[c].piece)&&y[h]==n[c].from&&y[u]==n[c].to&&(!d||d.toLowerCase()==n[c].promotion))return n[c];if(p){const f=O(n[c].from);if((!o||o.toLowerCase()==n[c].piece)&&y[u]==n[c].to&&(h==f[0]||h==f[1])&&(!d||d.toLowerCase()==n[c].promotion))return n[c]}}else if(i===Oe(this._moveToSan(n[c],n)).replace("x",""))return n[c];return null}ascii(){let e=`   +------------------------+
`;for(let t=y.a8;t<=y.h1;t++){if(be(t)===0&&(e+=" "+"87654321"[se(t)]+" |"),this._board[t]){const i=this._board[t].type,n=this._board[t].color===I?i.toUpperCase():i.toLowerCase();e+=" "+n+" "}else e+=" . ";t+1&136&&(e+=`|
`,t+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let i=0;const r=this._turn;for(let n=0,o=t.length;n<o;n++)this._makeMove(t[n]),this._isKingAttacked(r)||(e-1>0?i+=this.perft(e-1):i++),this._undoMove();return i}turn(){return this._turn}board(){const e=[];let t=[];for(let i=y.a8;i<=y.h1;i++)this._board[i]==null?t.push(null):t.push({square:O(i),type:this._board[i].type,color:this._board[i].color}),i+1&136&&(e.push(t),t=[],i+=8);return e}squareColor(e){if(e in y){const t=y[e];return(se(t)+be(t))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],i=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const r=t.pop();if(!r)break;e?i.push(new Ee(this,r)):i.push(this._moveToSan(r,this._moves())),this._makeMove(r)}return i}_getPositionCount(e){const t=je(e);return this._positionCount[t]||0}_incPositionCount(e){const t=je(e);this._positionCount[t]===void 0&&(this._positionCount[t]=0),this._positionCount[t]+=1}_decPositionCount(e){const t=je(e);this._positionCount[t]===1?delete this._positionCount[t]:this._positionCount[t]-=1}_pruneComments(){const e=[],t={},i=r=>{r in this._comments&&(t[r]=this._comments[r])};for(;this._history.length>0;)e.push(this._undoMove());for(i(this.fen());;){const r=e.pop();if(!r)break;this._makeMove(r),i(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(const r of[T,X])t[r]!==void 0&&(t[r]?this._castling[e]|=ye[r]:this._castling[e]&=~ye[r]);this._updateCastlingRights();const i=this.getCastlingRights(e);return(t[T]===void 0||t[T]===i[T])&&(t[X]===void 0||t[X]===i[X])}getCastlingRights(e){return{[T]:(this._castling[e]&ye[T])!==0,[X]:(this._castling[e]&ye[X])!==0}}moveNumber(){return this._moveNumber}}class ls extends Pe{constructor(){super();m(this,"material");const t=this.assetsManager.assets.get("outlineAlpha"),i=new nt(1,1,2,2);this.material=new tt({color:3407701,emissive:3407701,emissiveIntensity:10,opacity:1,transparent:!0}),this.material.alphaMap=t;const r=new G(i,this.material);r.rotation.x=-Math.PI/2,this.visible=!1,this.add(r)}markError(){this.material.color.set(16750865),this.material.emissive.set(16750865),this.material.emissiveIntensity=20}markSuccess(){this.material.color.set(5635840),this.material.emissive.set(5635840),this.material.emissiveIntensity=10}}var ve=Object.freeze({Linear:Object.freeze({None:function(s){return s},In:function(s){return s},Out:function(s){return s},InOut:function(s){return s}}),Quadratic:Object.freeze({In:function(s){return s*s},Out:function(s){return s*(2-s)},InOut:function(s){return(s*=2)<1?.5*s*s:-.5*(--s*(s-2)-1)}}),Cubic:Object.freeze({In:function(s){return s*s*s},Out:function(s){return--s*s*s+1},InOut:function(s){return(s*=2)<1?.5*s*s*s:.5*((s-=2)*s*s+2)}}),Quartic:Object.freeze({In:function(s){return s*s*s*s},Out:function(s){return 1- --s*s*s*s},InOut:function(s){return(s*=2)<1?.5*s*s*s*s:-.5*((s-=2)*s*s*s-2)}}),Quintic:Object.freeze({In:function(s){return s*s*s*s*s},Out:function(s){return--s*s*s*s*s+1},InOut:function(s){return(s*=2)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2)}}),Sinusoidal:Object.freeze({In:function(s){return 1-Math.sin((1-s)*Math.PI/2)},Out:function(s){return Math.sin(s*Math.PI/2)},InOut:function(s){return .5*(1-Math.sin(Math.PI*(.5-s)))}}),Exponential:Object.freeze({In:function(s){return s===0?0:Math.pow(1024,s-1)},Out:function(s){return s===1?1:1-Math.pow(2,-10*s)},InOut:function(s){return s===0?0:s===1?1:(s*=2)<1?.5*Math.pow(1024,s-1):.5*(-Math.pow(2,-10*(s-1))+2)}}),Circular:Object.freeze({In:function(s){return 1-Math.sqrt(1-s*s)},Out:function(s){return Math.sqrt(1- --s*s)},InOut:function(s){return(s*=2)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1)}}),Elastic:Object.freeze({In:function(s){return s===0?0:s===1?1:-Math.pow(2,10*(s-1))*Math.sin((s-1.1)*5*Math.PI)},Out:function(s){return s===0?0:s===1?1:Math.pow(2,-10*s)*Math.sin((s-.1)*5*Math.PI)+1},InOut:function(s){return s===0?0:s===1?1:(s*=2,s<1?-.5*Math.pow(2,10*(s-1))*Math.sin((s-1.1)*5*Math.PI):.5*Math.pow(2,-10*(s-1))*Math.sin((s-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(s){var e=1.70158;return s===1?1:s*s*((e+1)*s-e)},Out:function(s){var e=1.70158;return s===0?0:--s*s*((e+1)*s+e)+1},InOut:function(s){var e=2.5949095;return(s*=2)<1?.5*(s*s*((e+1)*s-e)):.5*((s-=2)*s*((e+1)*s+e)+2)}}),Bounce:Object.freeze({In:function(s){return 1-ve.Bounce.Out(1-s)},Out:function(s){return s<1/2.75?7.5625*s*s:s<2/2.75?7.5625*(s-=1.5/2.75)*s+.75:s<2.5/2.75?7.5625*(s-=2.25/2.75)*s+.9375:7.5625*(s-=2.625/2.75)*s+.984375},InOut:function(s){return s<.5?ve.Bounce.In(s*2)*.5:ve.Bounce.Out(s*2-1)*.5+.5}}),generatePow:function(s){return s===void 0&&(s=4),s=s<Number.EPSILON?Number.EPSILON:s,s=s>1e4?1e4:s,{In:function(e){return Math.pow(e,s)},Out:function(e){return 1-Math.pow(1-e,s)},InOut:function(e){return e<.5?Math.pow(e*2,s)/2:(1-Math.pow(2-e*2,s))/2+.5}}}}),me=function(){return performance.now()},cs=function(){function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return s.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},s.prototype.removeAll=function(){this._tweens={}},s.prototype.add=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];for(var r=0,n=t;r<n.length;r++){var o=n[r];(e=o._group)===null||e===void 0||e.remove(o),o._group=this,this._tweens[o.getId()]=o,this._tweensAddedDuringUpdate[o.getId()]=o}},s.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=0,r=e;i<r.length;i++){var n=r[i];n._group=void 0,delete this._tweens[n.getId()],delete this._tweensAddedDuringUpdate[n.getId()]}},s.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},s.prototype.update=function(e,t){e===void 0&&(e=me()),t===void 0&&(t=!0);var i=Object.keys(this._tweens);if(i.length!==0)for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var n=this._tweens[i[r]],o=!t;n&&n.update(e,o)===!1&&!t&&this.remove(n)}i=Object.keys(this._tweensAddedDuringUpdate)}},s}(),Le={Linear:function(s,e){var t=s.length-1,i=t*e,r=Math.floor(i),n=Le.Utils.Linear;return e<0?n(s[0],s[1],i):e>1?n(s[t],s[t-1],t-i):n(s[r],s[r+1>t?t:r+1],i-r)},Utils:{Linear:function(s,e,t){return(e-s)*t+s}}},ft=function(){function s(){}return s.nextId=function(){return s._nextId++},s._nextId=0,s}(),qe=new cs,Ve=function(){function s(e,t){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=ve.Linear.None,this._interpolationFunction=Le.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=ft.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,typeof t=="object"?(this._group=t,t.add(this)):t===!0&&(this._group=qe,qe.add(this))}return s.prototype.getId=function(){return this._id},s.prototype.isPlaying=function(){return this._isPlaying},s.prototype.isPaused=function(){return this._isPaused},s.prototype.getDuration=function(){return this._duration},s.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},s.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},s.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},s.prototype.start=function(e,t){if(e===void 0&&(e=me()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var i in this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var n in this._valuesEnd)r[n]=this._valuesEnd[n];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},s.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},s.prototype._setupProperties=function(e,t,i,r,n){for(var o in i){var a=e[o],h=Array.isArray(a),u=h?"array":typeof a,d=!h&&Array.isArray(i[o]);if(!(u==="undefined"||u==="function")){if(d){var p=i[o];if(p.length===0)continue;for(var c=[a],w=0,f=p.length;w<f;w+=1){var E=this._handleRelativeValue(a,p[w]);if(isNaN(E)){d=!1,console.warn("Found invalid interpolation list. Skipping.");break}c.push(E)}d&&(i[o]=c)}if((u==="object"||h)&&a&&!d){t[o]=h?[]:{};var v=a;for(var _ in v)t[o][_]=v[_];r[o]=h?[]:{};var p=i[o];if(!this._isDynamic){var x={};for(var _ in p)x[_]=p[_];i[o]=p=x}this._setupProperties(v,t[o],p,r[o],n)}else(typeof t[o]>"u"||n)&&(t[o]=a),h||(t[o]*=1),d?r[o]=i[o].slice().reverse():r[o]=t[o]||0}}},s.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},s.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},s.prototype.pause=function(e){return e===void 0&&(e=me()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this)},s.prototype.resume=function(e){return e===void 0&&(e=me()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this)},s.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},s.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},s.prototype.remove=function(){var e;return(e=this._group)===null||e===void 0||e.remove(this),this},s.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},s.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},s.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},s.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},s.prototype.easing=function(e){return e===void 0&&(e=ve.Linear.None),this._easingFunction=e,this},s.prototype.interpolation=function(e){return e===void 0&&(e=Le.Linear),this._interpolationFunction=e,this},s.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},s.prototype.onStart=function(e){return this._onStartCallback=e,this},s.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},s.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},s.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},s.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},s.prototype.onStop=function(e){return this._onStopCallback=e,this},s.prototype.update=function(e,t){var i=this,r;if(e===void 0&&(e=me()),t===void 0&&(t=s.autoStartOnUpdate),this._isPaused)return!0;var n;if(!this._goToEnd&&!this._isPlaying)if(t)this.start(e,!0);else return!1;if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var o=e-this._startTime,a=this._duration+((r=this._repeatDelayTime)!==null&&r!==void 0?r:this._delayTime),h=this._duration+this._repeat*a,u=function(){if(i._duration===0||o>h)return 1;var E=Math.trunc(o/a),v=o-E*a,_=Math.min(v/i._duration,1);return _===0&&o===i._duration?1:_},d=u(),p=this._easingFunction(d);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,p),this._onUpdateCallback&&this._onUpdateCallback(this._object,d),this._duration===0||o>=this._duration)if(this._repeat>0){var c=Math.min(Math.trunc((o-this._duration)/a)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=c);for(n in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[n]=="string"&&(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=a*c,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var w=0,f=this._chainedTweens.length;w<f;w++)this._chainedTweens[w].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},s.prototype._updateProperties=function(e,t,i,r){for(var n in i)if(t[n]!==void 0){var o=t[n]||0,a=i[n],h=Array.isArray(e[n]),u=Array.isArray(a),d=!h&&u;d?e[n]=this._interpolationFunction(a,r):typeof a=="object"&&a?this._updateProperties(e[n],o,a,r):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(e[n]=o+(a-o)*r))}},s.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},s.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],i=this._valuesEnd[e];typeof i=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(i):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},s.autoStartOnUpdate=!1,s}();ft.nextId;var U=qe;U.getAll.bind(U);U.removeAll.bind(U);U.add.bind(U);U.remove.bind(U);U.update.bind(U);const Se=["a","b","c","d","e","f","g","h"],ae=class ae extends Pe{constructor(t){super();m(this,"pieces",[]);m(this,"piecesMap",new Map);const i=this.assetsManager.assets.get("OBoard");console.log({board:i});const r=i.scene.clone();r.scale.setScalar(2.1),r.position.y=.235,r.castShadow=!0,r.receiveShadow=!0;let n=new G,o=new G,a=new G,h=new G,u=new G,d=new G;const p=[];for(let v=0;v<r.children.length;v++){const _=r.children[v];_.castShadow=!0,_.receiveShadow=!0,_.name==="Pawn"&&(n=_),_.name==="Rook"&&(o=_),_.name==="Knight"&&(a=_),_.name==="Bishop"&&(h=_),_.name==="King"&&(u=_),_.name==="Queen"&&(d=_),_.name!=="Board"?(_.material.roughness=.9,_.material.metalness=0,p.push(_)):(console.log("BOARD"),_.position.set(0,.235,0),_.material.roughness=.2,_.material.metalness=1,_.scale.setScalar(2.1),this.add(_))}p.forEach(v=>v.removeFromParent());const c=n.material.clone();c.color.setHex(10061943);const w=n.material.clone();w.color.setHex(2228258);for(let v=0;v<8;v++){let _=n.clone(),x=n.clone();this.add(_);let b=t.get(Se[v]+2).position;_.position.set(b.x,b.y+ae.OFFSET_Y,b.z),_.scale.setScalar(2.065),_.material=c,this.piecesMap.set(Se[v]+2,_),this.pieces.push(_),_.name+="new",this.add(x),b=t.get(Se[v]+7).position,x.position.set(b.x,b.y+ae.OFFSET_Y,b.z),x.scale.setScalar(2.065),x.material=w,this.piecesMap.set(Se[v]+7,x),this.pieces.push(x),x.name+="new"}const f=(v,_,x)=>{let b=t.get(_).position;return v.position.set(b.x,b.y+ae.OFFSET_Y,b.z),v.scale.setScalar(2.065),v.material=x,this.add(v),this.pieces.push(v),this.piecesMap.set(_,v),v.name+="new",v};f(o.clone(),"a1",c),f(a.clone(),"b1",c),f(h.clone(),"c1",c),f(d.clone(),"d1",c),f(u.clone(),"e1",c),f(h.clone(),"f1",c),f(a.clone(),"g1",c),f(o.clone(),"h1",c),f(o.clone(),"a8",w);let E=f(a.clone(),"b8",w);E.rotation.y=Math.PI,f(h.clone(),"c8",w),f(d.clone(),"d8",w),f(u.clone(),"e8",w),f(h.clone(),"f8",w),E=f(a.clone(),"g8",w),E.rotation.y=Math.PI,f(o.clone(),"h8",w)}};m(ae,"OFFSET_Y",0);let Fe=ae;const oe=2;class us extends Dt{constructor(){super(),this.map=this.assetsManager.assets.get("stoneWall_Diffuse"),this.map.colorSpace=At,this.map.repeat.set(oe,oe),this.map.wrapS=re,this.map.wrapT=re,this.color.set(15641207),this.aoMap=this.assetsManager.assets.get("stoneWall_ARM"),this.aoMap.repeat.set(oe,oe),this.aoMap.wrapS=re,this.aoMap.wrapT=re,this.roughnessMap=this.assetsManager.assets.get("stoneWall_ARM"),this.metalnessMap=this.assetsManager.assets.get("stoneWall_ARM"),this.normalMap=this.assetsManager.assets.get("stoneWall_Normal"),this.normalMap.repeat.set(oe,oe),this.normalMap.wrapS=re,this.normalMap.wrapT=re,this.roughness=.85,this.alphaMap=this.assetsManager.assets.get("roundAlpha"),this.transparent=!0}}class fs extends Rt{constructor(){super();m(this,"debugFolder");const t=new nt(18,18,1,1),i=new us,r=new G(t,i);r.rotation.x=-Math.PI/2,r.receiveShadow=!0,r.castShadow=!0,this.add(r)}}class ps extends It{constructor(t,i){super();m(this,"loop");m(this,"orbit");m(this,"controls");m(this,"controls2");m(this,"selectedObject",null);m(this,"chess",new hs);m(this,"piecesMap",new Map);m(this,"cellsMap",new Map);m(this,"highlightedCell",null);m(this,"tween",null);m(this,"tween2",null);m(this,"classicBoard",null);m(this,"modernBoard",null);m(this,"setResult");m(this,"handleWarning");m(this,"move",()=>{});m(this,"update",()=>{var t,i,r,n,o;super.update(),(t=this.orbit)==null||t.update(),(i=this.controls)==null||i.update(),(r=this.controls2)==null||r.update(),(n=this.tween)==null||n.update(this.loop.elapsed*1e3),(o=this.tween2)==null||o.update(this.loop.elapsed*1e3)});m(this,"createPrototype",async()=>{const t=["a","b","c","d","e","f","g","h"];new qt(this).map;for(let l=0;l<8;l++)for(let g=0;g<8;g++){const M=new ls(l,g);M.position.y=.35,this.add(M),M.scale.setScalar(1.16),M.position.set((3.5-l)*1.16,.35,(g-3.5)*1.16),this.cellsMap.set(t[l]+(g+1).toString(),M)}const i=new fs;this.add(i);const r=new Ft(8);this.add(r),this.camera.position.set(0,15,15),this.orbit=new zt(this.camera,this.gameContext.canvas),this.orbit.enableDamping=!0,this.orbit.minDistance=8,this.orbit.maxDistance=40,this.orbit.maxPolarAngle=Math.PI*.37;const n=new Wt;this.classicBoard=n;const o=new Fe(this.cellsMap);this.modernBoard=o,this.add(o);const a=new Gt;this.add(a),this.controls=new Ye(n.pieces,this.camera,this.renderer.canvas),this.controls.recursive=!1,this.controls2=new Ye(o.pieces,this.camera,this.renderer.canvas),this.controls2.recursive=!1;let h=new Z,u=new q,d=new q;const p=new it(new q(0,.1,0),0),c=(l,g)=>{this.highlightedCell&&(this.highlightedCell.visible=!1);const M=new Z(Math.floor((l.position.x*g+4.5)/1.16),Math.floor((l.position.z*g+4.5)/1.16)),C=t[7-M.x]+(M.y+1).toString();this.highlightedCell=this.cellsMap.get(C),this.highlightedCell&&(this.highlightedCell.visible=!0,v(C)?this.highlightedCell.markSuccess():this.highlightedCell.markError())};let w=new q,f=null,E=[];const v=l=>E.length!==0&&(E.includes(l)||l===f);let _=!1;const x=l=>{this.orbit.enabled=!1,setTimeout(()=>{w=l.object.position.clone(),_=!0,this.orbit.enabled=!1;const g=l.object.name.includes("new")?1:20;K.setFromCamera(h,this.camera),K.ray.intersectPlane(p,u),d=l.object.position.sub(new q(u.x/g,u.y/g+.5/g,u.z/g)).clone(),l.object.position.set(u.x/g+d.x,u.y/g+.5/g,u.z/g+d.z);const M=new Z(Math.floor((l.object.position.x*g+4.5)/1.16),Math.floor((l.object.position.z*g+4.5)/1.16));f=t[7-M.x]+(M.y+1).toString(),E=this.chess.moves({square:f,verbose:!1}).map(C=>C.replace("+","")).map(C=>C.replace("#","").slice(-2)),console.log({moves:E},f,l,this.chess.moves({square:f,verbose:!1}),this.chess.history()),c(l.object,g)},0)},b=l=>{if(!_)return;K.setFromCamera(h,this.camera),K.ray.intersectPlane(p,u);const g=l.object.name.includes("new")?1:20;l.object.position.set(u.x/g+d.x,u.y/g+.5/g,u.z/g+d.z),c(l.object,g)};let R=0,D=0;const ie=(l,g,M=!1)=>{var ce,ze,Be,Ue,Ke,We,Ge;this.chess.move({from:l,to:g});const C=this.piecesMap.get(g),z=this.piecesMap.get(l),P=o.piecesMap.get(g),F=o.piecesMap.get(l);if(!z||!F)return;const ee=this.cellsMap.get(l).position.distanceTo(this.cellsMap.get(g).position);if(M)(ce=this.tween)==null||ce.remove(),(ze=this.tween2)==null||ze.remove(),this.tween=new Ve(z.position),this.tween2=new Ve(F.position),this.tween2.to(new q(this.cellsMap.get(g).position.x,F.position.y,this.cellsMap.get(g).position.z),ee*130).delay(0).start(),this.tween.to(new q(this.cellsMap.get(g).position.x/20,z.position.y,this.cellsMap.get(g).position.z/20),ee*130).delay(0).start().onComplete(()=>{var ne,ue,fe,we;if(C&&P){const pe=C.name.includes("white");pe?R++:D++;let Qe=pe?R:D;const He=pe?6.15:-6.15;C.position.x=He/20,C.position.z=(-6.5+Qe)/25,C.position.y=0;const pt=(ne=this.controls)==null?void 0:ne.objects.indexOf(C);(ue=this.controls)==null||ue.objects.splice(pt,1),P.position.x=He,P.position.z=(-6.5+Qe)*.8,P.position.y=0;const dt=(fe=this.controls2)==null?void 0:fe.objects.indexOf(P);(we=this.controls2)==null||we.objects.splice(dt,1)}});else if(z.position.x=this.cellsMap.get(g).position.x/20,z.position.z=this.cellsMap.get(g).position.z/20,F.position.x=this.cellsMap.get(g).position.x,F.position.z=this.cellsMap.get(g).position.z,C&&P){const ne=C.name.includes("white");ne?R++:D++;let ue=ne?R:D;const fe=ne?6.15:-6.15;C.position.x=fe/20,C.position.y=0,C.position.z=(-6.5+ue)/25;const we=(Be=this.controls)==null?void 0:Be.objects.indexOf(C);(Ue=this.controls)==null||Ue.objects.splice(we,1),P.position.x=fe,P.position.z=(-6.5+ue)*.8,P.position.y=0;const pe=(Ke=this.controls2)==null?void 0:Ke.objects.indexOf(P);(We=this.controls2)==null||We.objects.splice(pe,1)}if(this.piecesMap.set(g,z),o.piecesMap.set(g,F),this.piecesMap.set(l,null),o.piecesMap.set(l,null),console.log(this.chess.ascii()),console.log("isGameOver",this.chess.isGameOver(),"isCheck",this.chess.isCheck(),"; isDraw",this.chess.isDraw(),"; isMate:",this.chess.isCheckmate(),"; isPlayer:",!M,this.chess.moves(),this.chess.isThreefoldRepetition(),this.chess.isInsufficientMaterial()),this.chess.isCheck()&&(console.log("HANDLE WARNING"),(Ge=this.handleWarning)==null||Ge.call(this)),this.chess.isGameOver()){if(this.chess.isDraw()){this.setResult("~ DRAW ~");return}if(this.chess.isCheckmate()){this.setResult(M?"You Lose :(":"You Win :)");return}}},le=()=>{const l=this.chess.moves({verbose:!0}).filter(C=>!C.promotion),M=l.find(C=>C.captured&&!C.promotion)??l[Math.floor(Math.random()*l.length)];console.log("AI move",M),ie(M.from,M.to,!0)},V=l=>{_=!1,this.orbit.enabled=!0;const g=l.object.name.includes("new")?1:20;l.object.position.y=.35/g;const M=new Z(Math.floor((l.object.position.x*g+4.5)/1.16),Math.floor((l.object.position.z*g+4.5)/1.16)),C=t[7-M.x]+(M.y+1).toString();console.log("END",{moves:E},C,f),this.highlightedCell?(f!==C&&v(C)?(ie(f,C),setTimeout(le,0),console.log(this.chess.ascii())):(l.object.position.x=w.x,l.object.position.z=w.z),this.highlightedCell.visible=!1,this.highlightedCell=null):(l.object.position.x=w.x,l.object.position.z=w.z)};this.controls.addEventListener("dragstart",x),this.controls.addEventListener("drag",b),this.controls.addEventListener("dragend",V),this.controls2.addEventListener("dragstart",x),this.controls2.addEventListener("drag",b),this.controls2.addEventListener("dragend",V),ke.getInstance().canvas.addEventListener("touchstart",l=>{var C,z,P,F,ee,ce;l.preventDefault(),console.log("TOUCH",(z=(C=l.touches)==null?void 0:C[0])==null?void 0:z.clientX);const g=((F=(P=l.touches)==null?void 0:P[0])==null?void 0:F.clientX)/window.innerWidth*2-1,M=-(((ce=(ee=l.touches)==null?void 0:ee[0])==null?void 0:ce.clientY)/window.innerHeight)*2+1;h.x=g,h.y=M});const K=new st;ke.getInstance().canvas.addEventListener("pointermove",l=>{l.preventDefault();const g=l.clientX/window.innerWidth*2-1,M=-(l.clientY/window.innerHeight)*2+1;if(h.x=g,h.y=M,this.controls.state!==-1&&this.controls2.state!==-1)return;K.setFromCamera(new Z(g,M),this.camera),a.position.set(0,-1,0);const C=K.intersectObjects(n.pieces,!0);if(this.selectedObject&&(this.selectedObject.position.y=.35/20,this.selectedObject=null),C.length>0){let P=C.sort((F,ee)=>F.distance-ee.distance)[0].object;P.name.includes("piece")||(P=P.parent),this.selectedObject=P,a.position.set(P.position.x*20,.35,P.position.z*20)}}),console.log("TestLevelScene constructor");for(let l=0;l<8;l++)for(let g=0;g<8;g++)this.piecesMap.set(t[g]+(l+1).toString(),null);this.piecesMap.set("h1",n.pieces.find(({name:l})=>l==="piece_rook_white_02")??null),this.piecesMap.set("g1",n.pieces.find(({name:l})=>l==="piece_knight_white_02")??null),this.piecesMap.set("f1",n.pieces.find(({name:l})=>l==="piece_bishop_white_02")??null),this.piecesMap.set("e1",n.pieces.find(({name:l})=>l==="piece_king_white")??null),this.piecesMap.set("d1",n.pieces.find(({name:l})=>l==="piece_queen_white")??null),this.piecesMap.set("c1",n.pieces.find(({name:l})=>l==="piece_bishop_white_01")??null),this.piecesMap.set("b1",n.pieces.find(({name:l})=>l==="piece_knight_white_01")??null),this.piecesMap.set("a1",n.pieces.find(({name:l})=>l==="piece_rook_white_01")??null);for(let l=0;l<8;l++)this.piecesMap.set(t[l]+"2",n.pieces.find(({name:g})=>g==="piece_pawn_white_0"+(l+1))??null);this.piecesMap.set("h8",n.pieces.find(({name:l})=>l==="piece_rook_black_01")??null),this.piecesMap.set("g8",n.pieces.find(({name:l})=>l==="piece_knight_black_01")??null),this.piecesMap.set("f8",n.pieces.find(({name:l})=>l==="piece_bishop_black_01")??null),this.piecesMap.set("e8",n.pieces.find(({name:l})=>l==="piece_king_black")??null),this.piecesMap.set("d8",n.pieces.find(({name:l})=>l==="piece_queen_black")??null),this.piecesMap.set("c8",n.pieces.find(({name:l})=>l==="piece_bishop_black_02")??null),this.piecesMap.set("b8",n.pieces.find(({name:l})=>l==="piece_knight_black_02")??null),this.piecesMap.set("a8",n.pieces.find(({name:l})=>l==="piece_rook_black_02")??null);for(let l=0;l<8;l++)this.piecesMap.set(t[l]+"7",n.pieces.find(({name:g})=>g==="piece_pawn_black_0"+(8-l))??null);console.log(this.piecesMap),le()});this.handleWarning=i,this.setResult=t,this.gameContext.assetsManager.addEventListener(rt.LOAD_COMPLETE,this.createPrototype),this.loop=this.gameContext.loop,Ot.isActive=!1}classic(t){t?(this.add(this.classicBoard),this.remove(this.modernBoard),this.controls.enabled=!0,this.controls2.enabled=!1):(this.add(this.modernBoard),this.remove(this.classicBoard),this.controls.enabled=!1,this.controls2.enabled=!0)}createCamera(){return new Lt().camera}createRenderer(){return new Kt(this.gameContext.canvas,this,this.camera,this.gameContext.size)}dispose(){var t,i;super.dispose(),(t=this.tween)==null||t.remove(),(i=this.tween2)==null||i.remove()}}class ds extends jt{constructor(t,i,r){console.log("Create chess game");super(t);m(this,"resize",()=>{this.scene.resize()});this.loadLevelScene(new ps(i,r)),ke.getInstance().size.addEventListener(Nt.RESIZE_EVENT,this.resize)}createDebug(){}createAssetsManager(){return new rt(Ut)}classic(t){this.scene.classic(t)}}let et;const vs=()=>{const s=W.useRef(null),e=W.useRef(null),[t,i]=W.useState(.01),[r,n]=W.useState(!1),[o,a]=W.useState(!1),[h,u]=W.useState(""),d=W.useCallback(()=>{a(!0),setTimeout(()=>{a(!1)},2500)},[]);return W.useEffect(()=>{s.current&&!e.current&&(e.current=new ds(s.current,u,d),et=setInterval(()=>{i(p=>Math.min(ke.getInstance().assetsManager.progress,p+.5))},100))},[]),W.useEffect(()=>{t===1&&clearInterval(et)},[t]),console.log({progress:t}),k.jsxs("div",{style:{position:"relative"},className:"chess-page",children:[k.jsxs("div",{style:{background:"#111111",position:"fixed",width:"100vw",height:"100vh",color:"white",fontSize:"2rem",display:t<1?"flex":"none",alignItems:"center",justifyContent:"center"},children:[k.jsx("div",{className:"progressShadow"}),k.jsxs("div",{children:[k.jsx("div",{className:"progress"}),k.jsx("div",{className:"progressBar",style:{width:`${t*19.8}rem`}})]})]}),t>=1&&k.jsxs("button",{className:"change-btn",onClick:()=>{var p;n(c=>!c),(p=e.current)==null||p.classic(!r)},children:[k.jsx("div",{className:"outer-glow"}),k.jsx("div",{className:"content",children:r?"Classic":"Modern"})]}),t>=1&&k.jsx(Bt,{title:"Change Board"}),k.jsx("canvas",{ref:s,className:"webgl-game",style:{touchAction:"none"}}),h&&k.jsx("div",{className:"win-notification",children:k.jsxs("div",{className:"win-notification-content",children:[k.jsx("div",{className:"line"}),k.jsx("div",{className:"bg",children:k.jsxs("div",{className:"win-body",children:[k.jsx("div",{className:"text",children:h}),k.jsx("button",{onClick:()=>location.reload(),children:"OK"})]})}),k.jsx("div",{className:"line",style:{top:"27px"}})]})}),k.jsxs("div",{className:`warning ${o?"warning-open":""}`,onClick:()=>{a(!1)},children:[k.jsxs("div",{className:"warning-content",children:[k.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"34px",viewBox:"0 -960 960 960",width:"34px",fill:"white",children:k.jsx("path",{d:"M480-120q-33 0-56.5-23.5T400-200q0-33 23.5-56.5T480-280q33 0 56.5 23.5T560-200q0 33-23.5 56.5T480-120Zm0-240q-33 0-56.5-23.5T400-440v-320q0-33 23.5-56.5T480-840q33 0 56.5 23.5T560-760v320q0 33-23.5 56.5T480-360Z"})}),"Check"]}),k.jsx("div",{className:"bg-glow"})]})]})};export{vs as default};
